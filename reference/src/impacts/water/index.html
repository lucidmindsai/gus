<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../../../img/favicon.ico">
  <title>Water - gus</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../../../css/theme.css" />
  <link rel="stylesheet" href="../../../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Water";
    var mkdocs_page_input_path = "reference/src/impacts/water.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../../../.." class="icon icon-home"> gus</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Reference</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">Src</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../">Index</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Gus</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../gus/agents/">Agents</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../gus/allometrics/">Allometrics</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../gus/">Index</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../gus/models/">Models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../gus/utilities/">Utilities</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../gus/weather/">Weather</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Impacts</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../carbon/">Carbon</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../">Index</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="./">Water</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#functions">Functions</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#classes">Classes</a>
    </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../..">gus</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Reference &raquo;</li>
        
      
        
          <li>Src &raquo;</li>
        
      
        
          <li>Impacts &raquo;</li>
        
      
    
    <li>Water</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/lucidmindsai/gus/edit/main/reference/src/impacts/water.md"> Edit on gus</a>
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="module-srcimpactswater">Module src.impacts.water</h1>
<p>None</p>
<p>None</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># Water retention related implementation.</span>

<span class="c1"># Based on Notebook implemenation created by Marko Petrovic</span>

<span class="c1"># Numerical data processing</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="c1"># Time series operations</span>

<span class="kn">import</span> <span class="nn">glob</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">Calibration</span><span class="p">():</span>

    <span class="sd">&quot;&quot;&quot;Water retention and impact estimate related parameters setting.&quot;&quot;&quot;</span>

    <span class="c1"># Conversion coefficient meter to millimeter</span>

    <span class="n">m_to_mm</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Extinction coefficient =0.7 for trees and 0.3 for shrubs (Wang et al. 2008)</span>

    <span class="n">kappa</span> <span class="o">=</span> <span class="mf">0.7</span>

    <span class="c1"># Shade factor, is the percentage of sky covered by foliage and branches within</span>

    <span class="c1"># the perimeter of individual tree crowns, can vary by species from about</span>

    <span class="c1"># 60% to 95% when trees are in-leaf (McPherson, 1984).</span>

    <span class="c1"># The value below is set according to Glasgow mean</span>

    <span class="n">avg_shade_factor</span> <span class="o">=</span> <span class="mf">0.85</span>

    <span class="c1"># Specific leaf storage of water (sl =0.0002 m).</span>

    <span class="n">leaf_storage</span> <span class="o">=</span> <span class="mf">0.0002</span> <span class="o">*</span> <span class="n">m_to_mm</span>

    <span class="c1"># Leaf-on leaf_off transition days (Wang_et_al_2008).</span>

    <span class="n">leaf_transition_days</span> <span class="o">=</span> <span class="mi">28</span>

    <span class="c1"># Specific impervious cover storage of water (=0.0015 m).</span>

    <span class="n">maximum_impervious_cover_storage</span> <span class="o">=</span> <span class="mf">0.0015</span> <span class="o">*</span> <span class="n">m_to_mm</span>

    <span class="c1"># Specific pervious cover storage of water (=0.001 m).</span>

    <span class="n">maximum_pervious_cover_storage</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">m_to_mm</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>

        <span class="bp">self</span><span class="p">,</span>

        <span class="n">leaf_transition_days</span> <span class="o">=</span> <span class="mi">28</span><span class="p">,</span>

        <span class="n">leaf_storage</span> <span class="o">=</span> <span class="mf">0.0002</span><span class="p">,</span>

        <span class="n">pervios_storage_max</span> <span class="o">=</span> <span class="mf">0.0010</span><span class="p">,</span>

        <span class="n">impervios_storage_max</span> <span class="o">=</span> <span class="mf">0.0015</span>

        <span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;The constructor method.</span>

<span class="sd">        Args:</span>

<span class="sd">            leaf_transition_days: (:obj:`int`): Leaf-on leaf_off transition days</span>

<span class="sd">            leaf_storage: (:obj:`float`): Specific leaf storage of water.</span>

<span class="sd">            pervios_storage_max: (:obj:`float`): Specific pervious cover storage of water</span>

<span class="sd">            impervios_storage_max: (:obj:`float`): Specific impervious cover storage of water</span>

<span class="sd">        Returns:</span>

<span class="sd">            None</span>

<span class="sd">        Note:</span>

<span class="sd">        TODO:</span>

<span class="sd">            * pass optional settings as key word parameters.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">leaf_storage</span> <span class="o">=</span> <span class="n">leaf_storage</span> <span class="o">*</span> <span class="n">Calibration</span><span class="o">.</span><span class="n">m_to_mm</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">leaf_transition_days</span> <span class="o">=</span> <span class="n">leaf_transition_days</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_impervious_cover_storage</span> <span class="o">=</span> <span class="n">impervios_storage_max</span> <span class="o">*</span> <span class="n">Calibration</span><span class="o">.</span><span class="n">m_to_mm</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">maximum_pervious_cover_storage</span> <span class="o">=</span> <span class="n">pervios_storage_max</span> <span class="o">*</span> <span class="n">Calibration</span><span class="o">.</span><span class="n">m_to_mm</span>

    <span class="k">def</span> <span class="nf">set_surface_storage_rates</span><span class="p">(</span>

        <span class="bp">self</span><span class="p">,</span> <span class="n">leaf_storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>

        <span class="n">pervios_storage_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>

        <span class="n">impervios_storage_max</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Setting specific water storage rates.</span>

<span class="sd">        Args:</span>

<span class="sd">            leaf_storage: (:obj:`float`): Specific leaf storage of water.</span>

<span class="sd">            pervios_storage_max: (:obj:`float`): Specific pervious cover storage of water</span>

<span class="sd">            impervios_storage_max: (:obj:`float`): Specific impervious cover storage of water</span>

<span class="sd">        Returns:</span>

<span class="sd">            None</span>

<span class="sd">        Note:</span>

<span class="sd">        Todo:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">leaf_storage</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">leaf_storage</span> <span class="o">=</span> <span class="n">leaf_storage</span> <span class="o">*</span> <span class="n">Calibration</span><span class="o">.</span><span class="n">m_to_mm</span>

        <span class="k">if</span> <span class="n">impervios_storage_max</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">maximum_impervious_cover_storage</span> <span class="o">=</span> <span class="n">impervios_storage_max</span> <span class="o">*</span> <span class="n">Calibration</span><span class="o">.</span><span class="n">m_to_mm</span>

        <span class="k">if</span> <span class="n">pervios_storage_max</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">maximum_pervious_cover_storage</span> <span class="o">=</span> <span class="n">pervios_storage_max</span> <span class="o">*</span> <span class="n">Calibration</span><span class="o">.</span><span class="n">m_to_mm</span>

<span class="k">def</span> <span class="nf">compute_leaf_area_index</span><span class="p">(</span>

    <span class="n">dbh</span><span class="p">,</span>

    <span class="n">tree_height</span><span class="p">,</span>

    <span class="n">crown_height</span><span class="p">,</span>

    <span class="n">crown_width</span><span class="p">,</span>

    <span class="n">crown_missing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

    <span class="n">shade_factor</span> <span class="o">=</span> <span class="n">Calibration</span><span class="o">.</span><span class="n">avg_shade_factor</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The function given allometrics of a tree computes its leaf, bark and plant area indices.</span>

<span class="sd">    Args:</span>

<span class="sd">        dbh: (:obj:`float`): the diameter in cm of the trunk usually measured at 1.3m from the ground.</span>

<span class="sd">        tree_height: (:obj:`float`): The tree height in meters.</span>

<span class="sd">        crown_height: (:obj:`float`): The vertical length of tree crown in meters.</span>

<span class="sd">        crown_width: (:obj:`float`): The horizontal length (diameter) of tree crown in meters.</span>

<span class="sd">        crown_missing: (:obj:`float`): The percentage loss of the crown.</span>

<span class="sd">        shade_factor: (:obj:`float`): The percentage of sky covered by foliage and branches.</span>

<span class="sd">    Returns:</span>

<span class="sd">        (:obj:`tuple`): the tuple returns the tree indices (LAI,BAI,PAI)</span>

<span class="sd">    Note:</span>

<span class="sd">        The beta multipliers and the main equation is based on Nowak (1996).</span>

<span class="sd">    TODO:</span>

<span class="sd">        Parametrize beta multipliers.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">loss</span> <span class="o">=</span> <span class="n">crown_missing</span>

    <span class="n">th</span> <span class="o">=</span> <span class="n">tree_height</span>

    <span class="n">cw</span> <span class="o">=</span> <span class="n">crown_width</span>

    <span class="n">ch</span> <span class="o">=</span> <span class="n">crown_height</span>

    <span class="n">sf</span> <span class="o">=</span> <span class="n">shade_factor</span>

    <span class="n">beta_0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4.3309</span>

    <span class="n">beta_1</span> <span class="o">=</span> <span class="mf">0.2942</span>

    <span class="n">beta_2</span> <span class="o">=</span> <span class="mf">0.7312</span>

    <span class="n">beta_3</span> <span class="o">=</span> <span class="mf">5.7217</span>

    <span class="n">beta_4</span> <span class="o">=</span> <span class="mf">0.0148</span>

    <span class="k">def</span> <span class="nf">compute_under_canopy_area</span><span class="p">(</span><span class="n">crown_width</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">pow</span><span class="p">((</span><span class="n">crown_width</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">def</span> <span class="nf">compute_bark_area</span><span class="p">(</span><span class="n">dbh</span><span class="p">,</span> <span class="n">tree_height</span><span class="p">,</span> <span class="n">crown_height</span><span class="p">):</span>

        <span class="c1"># * 0.01 converts DBH(cm) into meter.</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">dbh</span> <span class="o">*</span> <span class="mf">0.01</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">tree_height</span> <span class="o">-</span> <span class="n">crown_height</span><span class="p">)</span>

    <span class="c1"># Outer surface area estimate below is based on Gacka-Grzesikiewicz (1980).</span>

    <span class="n">under_canopy</span> <span class="o">=</span> <span class="n">compute_under_canopy_area</span><span class="p">(</span><span class="n">cw</span><span class="p">)</span>

    <span class="n">crown_surface</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="o">*</span> <span class="n">crown_width</span> <span class="o">*</span> <span class="p">(</span><span class="n">crown_height</span> <span class="o">+</span> <span class="n">crown_width</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    <span class="n">bark_area</span> <span class="o">=</span> <span class="n">compute_bark_area</span><span class="p">(</span><span class="n">dbh</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">ch</span><span class="p">)</span>

    <span class="n">leaf_area</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">loss</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="kp">exp</span><span class="p">(</span><span class="n">beta_0</span> <span class="o">+</span> <span class="n">beta_1</span> <span class="o">*</span> <span class="n">th</span> <span class="o">+</span> <span class="n">beta_2</span> <span class="o">*</span> <span class="n">cw</span> <span class="o">+</span> <span class="n">beta_3</span> <span class="o">*</span> <span class="n">sf</span> <span class="o">-</span> <span class="n">beta_4</span> <span class="o">*</span> <span class="n">crown_surface</span><span class="p">)</span>

    <span class="n">leaf_area_index</span> <span class="o">=</span> <span class="n">leaf_area</span> <span class="o">/</span> <span class="n">under_canopy</span>

    <span class="n">bark_area_index</span> <span class="o">=</span> <span class="n">bark_area</span> <span class="o">/</span> <span class="n">under_canopy</span>

    <span class="n">plant_area_index</span> <span class="o">=</span> <span class="n">leaf_area_index</span> <span class="o">+</span> <span class="n">bark_area_index</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">leaf_area_index</span><span class="p">,</span> <span class="n">bark_area_index</span><span class="p">,</span> <span class="n">plant_area_index</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">pai_seasons</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">leaf_on_start</span><span class="p">,</span> <span class="n">leaf_off_start</span><span class="p">,</span> <span class="n">leaf_transition_days</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method updates Plant Area Index (PAI) with respect to leaf on-off seasons.</span>

<span class="sd">    Args:</span>

<span class="sd">        A data frame &quot;x&quot; with following variables:</span>

<span class="sd">        Date_time: (:obj:`time`): date and time</span>

<span class="sd">        BAI: Bark Area Index</span>

<span class="sd">        LAI: Leaf Area Index</span>

<span class="sd">        conifers: it taks value &quot;true&quot; if conifers and &quot;false&quot; otherwise</span>

<span class="sd">        leaf_on_start: a day in the year when the leaf on season starts. In the case of Glasgow it is April 14 (day 105).</span>

<span class="sd">                        See also other sources: https://weatherspark.com/y/147740/Average-Weather-at-Glasgow-Airport-United-Kingdom-Year-Round</span>

<span class="sd">        leaf_off_start: a day in the year when the leaf off season starts. In the case of Glasgow it is November 2 (day 307).</span>

<span class="sd">        leaf_transition_days: the number of days that the leaf on-off transition last.</span>

<span class="sd">    Returns:</span>

<span class="sd">        An array of values of Plant Area Indexes (PAI) over time.</span>

<span class="sd">    Note:</span>

<span class="sd">        The function is built upon the following paper:</span>

<span class="sd">        Wang, Jun, Theodore A. Endreny, and David J. Nowak. “Mechanistic Simulation of Tree</span>

<span class="sd">        Effects in an Urban Water Balance Model 1.” JAWRA Journal of the American Water Resources</span>

<span class="sd">        Association 44, no. 1 (February 2008): 75–85. https://doi.org/10.1111/j.1752-1688.2007.00139.x</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">PAI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">where</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;Conifers&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;BAI&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;LAI&#39;</span><span class="p">],</span>

                                <span class="n">np</span><span class="o">.</span><span class="kp">where</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_of_year</span> <span class="o">&lt;</span> <span class="n">leaf_on_start</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;BAI&#39;</span><span class="p">],</span>

                                    <span class="n">np</span><span class="o">.</span><span class="kp">where</span><span class="p">(((</span><span class="n">x</span><span class="o">.</span><span class="n">Date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_of_year</span> <span class="o">&gt;=</span> <span class="n">leaf_on_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_of_year</span> <span class="o">&lt;</span> <span class="n">leaf_off_start</span><span class="p">)),</span>

                                    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;LAI&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="kp">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.37</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_of_year</span><span class="o">-</span><span class="p">(</span><span class="n">leaf_on_start</span><span class="o">+</span><span class="n">leaf_transition_days</span><span class="o">/</span><span class="mi">2</span><span class="p">))))</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;BAI&#39;</span><span class="p">],</span>

                                    <span class="n">x</span><span class="p">[</span><span class="s1">&#39;LAI&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="kp">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.37</span><span class="o">*</span><span class="p">((</span><span class="n">leaf_off_start</span><span class="o">+</span><span class="n">leaf_transition_days</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">Date_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">day_of_year</span><span class="p">)))</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;BAI&#39;</span><span class="p">])))</span>

    <span class="p">)</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;PAI&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">lmbd</span><span class="p">(</span><span class="n">temperature</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculates latent heat of vaporization.</span>

<span class="sd">    Args:</span>

<span class="sd">        Temperature in [C]</span>

<span class="sd">    Returns:</span>

<span class="sd">        latent heat of vaporization in [MJ/Kg]</span>

<span class="sd">    Note:</span>

<span class="sd">        The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="mf">2.501</span><span class="o">-</span><span class="mf">0.002361</span><span class="o">*</span><span class="n">temperature</span>

<span class="k">def</span> <span class="nf">e_s</span><span class="p">(</span><span class="n">temperature</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculates saturated vapor pressure.</span>

<span class="sd">    Args:</span>

<span class="sd">        Temperature in [C]</span>

<span class="sd">    Returns:</span>

<span class="sd">        Saturated vapor pressure in [kPa]</span>

<span class="sd">    Note:</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="mf">0.6108</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="kp">exp</span><span class="p">(</span><span class="mf">17.27</span><span class="o">*</span><span class="n">temperature</span><span class="o">/</span><span class="p">(</span><span class="mf">237.3</span><span class="o">+</span><span class="n">temperature</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">e</span><span class="p">(</span><span class="n">dew_point_temperature</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculates vapor pressure.</span>

<span class="sd">    Args:</span>

<span class="sd">        Dew point temperature in [C]</span>

<span class="sd">    Returns:</span>

<span class="sd">        Vapor pressure in [kPa]</span>

<span class="sd">    Note:</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="mf">0.6108</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="kp">exp</span><span class="p">(</span><span class="mf">17.27</span><span class="o">*</span><span class="n">dew_point_temperature</span><span class="o">/</span><span class="p">(</span><span class="mf">237.3</span><span class="o">+</span><span class="n">dew_point_temperature</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">DELTA</span><span class="p">(</span><span class="n">temperature</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculates the slope of vapor pressure temperature curve.</span>

<span class="sd">    Args:</span>

<span class="sd">        Temperature in [C]</span>

<span class="sd">    Returns:</span>

<span class="sd">        Slope of vapor pressure temperature curve in [kPa/C]</span>

<span class="sd">    Note:</span>

<span class="sd">        It includes in calculation saturated vapor pressure in [kPa] which is calculated with function e_s()!</span>

<span class="sd">        The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="mi">4098</span><span class="o">*</span><span class="n">e_s</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">237.3</span><span class="o">+</span><span class="n">temperature</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span> <span class="nf">rho_a</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">surface_pressure</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculates the density of air.</span>

<span class="sd">    Args:</span>

<span class="sd">        Temperature in [C]</span>

<span class="sd">        Surface preasure in [kPa]</span>

<span class="sd">    Returns:</span>

<span class="sd">        The density of air in [kg/m^3]</span>

<span class="sd">    Note:</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="mf">3.486</span> <span class="o">*</span> <span class="n">surface_pressure</span><span class="o">/</span><span class="p">(</span><span class="mi">275</span><span class="o">+</span><span class="n">temperature</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">rho_w</span><span class="p">(</span><span class="n">temperature</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculates the density of water.</span>

<span class="sd">    Args:</span>

<span class="sd">        Temperature in [C]</span>

<span class="sd">    Returns:</span>

<span class="sd">        The density of water in [kg/m^3]</span>

<span class="sd">    Note:</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="mf">999.88</span> <span class="o">+</span> <span class="mf">0.018</span><span class="o">*</span><span class="n">temperature</span> <span class="o">-</span> <span class="mf">0.0051</span><span class="o">*</span><span class="n">temperature</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span> <span class="nf">D</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">dew_point_temperature</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculates vapor pressure deficit.</span>

<span class="sd">    Args:</span>

<span class="sd">        Temperature in [C]</span>

<span class="sd">        Dew point temperature in [C]</span>

<span class="sd">    Returns:</span>

<span class="sd">        Vapor pressure deficit in [kPa]</span>

<span class="sd">    Note:</span>

<span class="sd">            It includes in calculation vapor pressure as well as saturated vapor pressure, both in [kPa], which</span>

<span class="sd">            are calculated with functions e() e_s().</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">(</span><span class="n">e_s</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">-</span><span class="n">e</span><span class="p">(</span><span class="n">dew_point_temperature</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">U_t</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span> <span class="n">wind_estimate_height</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method estimates wind speed at the tree top.</span>

<span class="sd">    Args:</span>

<span class="sd">        Measured wind speed [m/s]</span>

<span class="sd">        Wind estimate height (tree height) [m]</span>

<span class="sd">    Returns:</span>

<span class="sd">        Wind speed at the tree top in [m/s]</span>

<span class="sd">    Note:</span>

<span class="sd">            The method is using two other parameters:</span>

<span class="sd">                Wind measurement height Z_u (usually 10m) and roughness height for water d_w which are set as constants.</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">wind_speed</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="kp">log</span><span class="p">(</span><span class="n">wind_estimate_height</span><span class="o">/</span><span class="n">d_w</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="kp">log</span><span class="p">(</span><span class="n">Z_u</span><span class="o">/</span><span class="n">d_w</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">r_a</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span> <span class="n">wind_estimate_height</span><span class="p">,</span> <span class="n">roughness_height</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculates aerodynamic resistance.</span>

<span class="sd">    Args:</span>

<span class="sd">        Measured wind speed [m/s]</span>

<span class="sd">        Wind estimate height (tree height) [m]</span>

<span class="sd">        Roughness_height [m]</span>

<span class="sd">    Returns:</span>

<span class="sd">        Aerodynamic resistance in [m/s]</span>

<span class="sd">    Note:</span>

<span class="sd">            It includes in calculation wind speed at the tree top U_t.</span>

<span class="sd">            If roughness height is negative, a new equation is applied to calculate aerodynamic resistance for</span>

<span class="sd">            the evapotranspiration from the soil.</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">roughness_height</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>

        <span class="k">return</span> <span class="mf">4.72</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="kp">log</span><span class="p">(</span><span class="n">wind_estimate_height</span><span class="o">/</span><span class="p">(</span><span class="n">Z_ov</span><span class="o">*</span><span class="n">roughness_height</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.53</span><span class="o">*</span><span class="n">U_t</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span> <span class="n">wind_estimate_height</span><span class="p">))</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">return</span> <span class="mi">208</span><span class="o">/</span><span class="n">U_t</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span> <span class="n">wind_estimate_height</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">gamma</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="n">surface_pressure</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculates psychrometric constant.</span>

<span class="sd">    Args:</span>

<span class="sd">        Temperature [C]</span>

<span class="sd">        Surface pressure [kPa]</span>

<span class="sd">    Returns:</span>

<span class="sd">        Psychrometric constant in [kPA/C]</span>

<span class="sd">    Note:</span>

<span class="sd">            It includes in calculation latent heat of vaporization lmbd().</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#return 10**(-3)*c_p*surface_pressure*10/(lmbd(temperature)*0.622)# pressure in mbar</span>

    <span class="k">return</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">c_p</span><span class="o">*</span><span class="n">surface_pressure</span><span class="o">/</span><span class="p">(</span><span class="n">lmbd</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">*</span><span class="mf">0.622</span><span class="p">)</span><span class="c1"># pressure in kPa</span>

<span class="k">def</span> <span class="nf">r_s</span><span class="p">(</span><span class="n">pai</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculates stomatal resistance.</span>

<span class="sd">    Args:</span>

<span class="sd">        Plant area index (PAI)</span>

<span class="sd">    Returns:</span>

<span class="sd">        Stomatal resistance in [s/m]</span>

<span class="sd">    Note:</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="mi">200</span><span class="o">/</span><span class="n">pai</span>

<span class="k">def</span> <span class="nf">C_leaf</span><span class="p">(</span><span class="n">temperature</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculates water vapor concentration at the evaporating surfaces within the leaf.</span>

<span class="sd">    Args:</span>

<span class="sd">        Temperature [C]</span>

<span class="sd">    Returns:</span>

<span class="sd">        Water vapor concentration at the evaporating surfaces within the leaf in [g/m^3]</span>

<span class="sd">    Note:</span>

<span class="sd">            Temerature in celsius [C] is converted to kelvins [K] such that T(K) = T(C)+273.15.</span>

<span class="sd">            The formula also includes saturated vapor pressure e_s() in [kPa].</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="mi">2165</span><span class="o">*</span><span class="n">e_s</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">temperature</span><span class="o">+</span><span class="mf">273.15</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">C_air</span><span class="p">(</span><span class="n">dew_point_temperature</span><span class="p">,</span> <span class="n">temperature</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculates water vapor concentration in the air.</span>

<span class="sd">    Args:</span>

<span class="sd">        Temperature [C]</span>

<span class="sd">        Dew point temperature [C]</span>

<span class="sd">    Returns:</span>

<span class="sd">        Water vapor concentration in the air in [g/m^3]</span>

<span class="sd">    Note:</span>

<span class="sd">            Temerature in celsius [C] is converted to kelvins [K] such that T(K) = T(C)+273.15.</span>

<span class="sd">            The formula also includes vapor pressure e() in [kPa].</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="mi">2165</span><span class="o">*</span><span class="n">e</span><span class="p">(</span><span class="n">dew_point_temperature</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">temperature</span><span class="o">+</span><span class="mf">273.15</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">potential_evaporation</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">dew_point</span><span class="p">,</span> <span class="n">solar_radiation</span><span class="p">,</span> <span class="n">sea_level_pressure</span><span class="p">,</span> <span class="n">pai</span><span class="p">,</span> <span class="n">wind_speed</span><span class="p">,</span> <span class="n">wind_estimate_height</span><span class="p">,</span> <span class="n">roughness_height</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculate potential evaporation.</span>

<span class="sd">    Args: a data frame</span>

<span class="sd">    Returns: the updated ata frame</span>

<span class="sd">    Note:</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">potential_evaporation</span> <span class="o">=</span> <span class="n">M_TO_MM</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">lmbd</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">*</span><span class="n">rho_w</span><span class="p">(</span><span class="n">temperature</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="n">DELTA</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">*</span><span class="n">solar_radiation</span><span class="o">+</span><span class="p">(</span><span class="n">rho_a</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">sea_level_pressure</span><span class="p">)</span><span class="o">*</span><span class="n">c_p</span><span class="o">*</span><span class="n">D</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">dew_point</span><span class="p">))</span><span class="o">/</span><span class="n">r_a</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span> <span class="n">wind_estimate_height</span><span class="p">,</span> <span class="n">roughness_height</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">DELTA</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">+</span><span class="n">gamma</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">sea_level_pressure</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">r_s</span><span class="p">(</span><span class="n">pai</span><span class="p">)</span><span class="o">/</span><span class="n">r_a</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span> <span class="n">wind_estimate_height</span><span class="p">,</span> <span class="n">roughness_height</span><span class="p">))))</span>

    <span class="k">return</span> <span class="n">potential_evaporation</span>

<span class="k">def</span> <span class="nf">potential_evapotranspiration</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method calculate potential evapotranspiration.</span>

<span class="sd">    Args: a data frame</span>

<span class="sd">    Returns: the updated ata frame</span>

<span class="sd">    Note:</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>

        <span class="n">Potential_evaporation_v</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">potential_evaporation</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Dew_Point</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Solar_Radiation</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Sea_Level_Pressure</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">PAI</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Wind_Speed</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">roughness_height_trees</span><span class="p">),</span>

        <span class="n">Potential_evaporation_g</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">potential_evaporation</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Dew_Point</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Solar_Radiation</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Sea_Level_Pressure</span><span class="p">,</span> <span class="mi">1</span>    <span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Wind_Speed</span><span class="p">,</span> <span class="mi">1</span>       <span class="p">,</span> <span class="n">roughness_height_bare_soil</span><span class="p">),</span>

        <span class="n">PET</span>                     <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">potential_evaporation</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Temperature</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Dew_Point</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Solar_Radiation</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Sea_Level_Pressure</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">PAI</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Wind_Speed</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>

        <span class="n">Transpiration</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">3600</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">PAI</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">((</span><span class="n">C_leaf</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Temperature</span><span class="p">)</span><span class="o">-</span><span class="n">C_air</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Dew_Point</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Temperature</span><span class="p">)),</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">r_s</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">PAI</span><span class="p">)</span><span class="o">+</span><span class="n">r_a</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Wind_Speed</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">roughness_height_trees</span><span class="p">))</span>

        <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>

        <span class="n">TF_average_ratio</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">where</span><span class="p">(((</span><span class="n">x</span><span class="o">.</span><span class="n">PET</span><span class="o">&gt;</span><span class="n">x</span><span class="o">.</span><span class="n">Transpiration</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">PET</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)),</span> <span class="n">x</span><span class="o">.</span><span class="n">Transpiration</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">PET</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="kp">nan</span><span class="p">)</span>

        <span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;TF_average_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;AgentID&#39;</span><span class="p">,</span><span class="s1">&#39;Step&#39;</span><span class="p">])[</span><span class="s1">&#39;TF_average_ratio&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>

        <span class="n">Transpiration</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">where</span><span class="p">(((</span><span class="n">x</span><span class="o">.</span><span class="n">PAI</span><span class="o">&lt;</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">LAI</span><span class="o">+</span><span class="n">x</span><span class="o">.</span><span class="n">BAI</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Transpiration</span> <span class="o">&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">PET</span><span class="p">)),</span> <span class="n">x</span><span class="o">.</span><span class="n">TF_average_ratio</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">PET</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Transpiration</span><span class="p">)</span>

        <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;TF_average_ratio&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">ped1</span><span class="p">(</span><span class="n">Date_time</span><span class="p">,</span> <span class="n">Precipitation</span><span class="p">,</span> <span class="n">Potential_evaporation</span><span class="p">,</span> <span class="n">Maximum_storage</span><span class="p">,</span> <span class="n">evp</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method computes precipitation-evaporation dynamics for one type at a time, which can be trees, pervious cover, impervious cover...</span>

<span class="sd">    Args:</span>

<span class="sd">        Date_time [time identifier]</span>

<span class="sd">        Precipitation [amount of water hitting the surface area of the type]</span>

<span class="sd">        Potential_evaporation [of the type for the given weather conditions]</span>

<span class="sd">        Maximum_storage [parameter: maximum storage of the type]</span>

<span class="sd">        evp [evaporation coefficient for the type]</span>

<span class="sd">    Returns:</span>

<span class="sd">        Precipitation storage of the type for each hour.</span>

<span class="sd">    Note:</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Date_time&#39;</span><span class="p">:</span><span class="n">Date_time</span><span class="p">,</span> <span class="s1">&#39;Precipitation&#39;</span><span class="p">:</span><span class="n">Precipitation</span><span class="p">,</span>

    <span class="s1">&#39;Potential_evaporation&#39;</span><span class="p">:</span><span class="n">Potential_evaporation</span><span class="p">})</span>

    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Storage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Potential_evaporation_lag1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Potential_evaporation</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">limit_direction</span> <span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">func2</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>

        <span class="c1"># non local variable ==&gt; will use pre_value from the ped function</span>

        <span class="k">nonlocal</span> <span class="n">x</span>

        <span class="n">new_value</span> <span class="o">=</span>  <span class="n">new_value</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">Maximum_storage</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Precipitation&#39;</span><span class="p">]</span><span class="o">-</span>

        <span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">Maximum_storage</span><span class="p">,</span><span class="n">x</span><span class="p">),((</span><span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">Maximum_storage</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">/</span>

        <span class="n">Maximum_storage</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">evp</span><span class="p">)</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Potential_evaporation_lag1&#39;</span><span class="p">]))))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">new_value</span>

        <span class="k">return</span> <span class="n">new_value</span>

    <span class="c1"># This line might throw a SettingWithCopyWarning warning</span>

    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span><span class="s1">&#39;Storage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:,:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">func2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Storage&quot;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">ped3</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">evp_v</span><span class="p">,</span> <span class="n">evp_g</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method computes precipitation-evaporation dynamics for each tree as well as the impervious and pervious covers.</span>

<span class="sd">    Args:</span>

<span class="sd">        A data frame including the following variables:</span>

<span class="sd">        Evaporation coefficient for trees: evp_v</span>

<span class="sd">        Evaporation coefficient for ground: evp_g</span>

<span class="sd">    Returns:</span>

<span class="sd">        A data frame with new variables: Vegetation_storage, Impervious_cover_storage_v, Pervious_cover_storage_v for each hour.</span>

<span class="sd">    Note:</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Storage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Potential_evaporation_v_lag1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Potential_evaporation_v</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">limit_direction</span> <span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Potential_evaporation_g_lag1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Potential_evaporation_g</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">limit_direction</span> <span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">func2</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>

        <span class="c1"># non local variable ==&gt; will use pre_value from the ped function</span>

        <span class="k">nonlocal</span> <span class="n">x</span>

        <span class="k">nonlocal</span> <span class="n">y</span>

        <span class="k">nonlocal</span> <span class="n">z</span>

        <span class="n">new_value_x</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Maximum_vegetation_storage&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Canopy_interception&#39;</span><span class="p">]</span><span class="o">-</span>

        <span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Maximum_vegetation_storage&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">),((</span><span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Maximum_vegetation_storage&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">)</span><span class="o">/</span>

        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Maximum_vegetation_storage&#39;</span><span class="p">])</span><span class="o">**</span><span class="p">(</span><span class="n">evp_v</span><span class="p">)</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Potential_evaporation_v_lag1&#39;</span><span class="p">]))))</span>

        <span class="n">Precipitation_on_the_ground_with_vegetation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">new_value_x</span><span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Maximum_vegetation_storage&#39;</span><span class="p">]))</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Through_canopy_precipitation&#39;</span><span class="p">]</span>

        <span class="n">new_value_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">MAXIMUM_IMPERVIOUS_COVER_STORAGE</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">Precipitation_on_the_ground_with_vegetation</span><span class="o">-</span>

        <span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">MAXIMUM_IMPERVIOUS_COVER_STORAGE</span><span class="p">,</span><span class="n">y</span><span class="p">),((</span><span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">MAXIMUM_IMPERVIOUS_COVER_STORAGE</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="o">/</span>

        <span class="n">MAXIMUM_IMPERVIOUS_COVER_STORAGE</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">evp_g</span><span class="p">)</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Potential_evaporation_g_lag1&#39;</span><span class="p">]))))</span>

        <span class="n">new_value_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">MAXIMUM_PERVIOUS_COVER_STORAGE</span><span class="p">,</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="n">Precipitation_on_the_ground_with_vegetation</span><span class="o">-</span>

        <span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">MAXIMUM_PERVIOUS_COVER_STORAGE</span><span class="p">,</span><span class="n">z</span><span class="p">),((</span><span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">MAXIMUM_PERVIOUS_COVER_STORAGE</span><span class="p">,</span><span class="n">z</span><span class="p">)</span><span class="o">/</span>

        <span class="n">MAXIMUM_PERVIOUS_COVER_STORAGE</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">evp_g</span><span class="p">)</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Potential_evaporation_g_lag1&#39;</span><span class="p">]))))</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">new_value_x</span>

        <span class="n">y</span> <span class="o">=</span> <span class="n">new_value_y</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">new_value_z</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">new_value_x</span><span class="p">,</span> <span class="n">new_value_y</span><span class="p">,</span> <span class="n">new_value_z</span><span class="p">]</span>

    <span class="c1"># This line might throw a SettingWithCopyWarning warning</span>

    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span><span class="s1">&#39;Storage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:,:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">func2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Vegetation_storage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Storage&#39;</span><span class="p">]</span><span class="o">.</span><span class="kp">tolist</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Impervious_cover_storage_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Storage&#39;</span><span class="p">]</span><span class="o">.</span><span class="kp">tolist</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Pervious_cover_storage_v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Storage&#39;</span><span class="p">]</span><span class="o">.</span><span class="kp">tolist</span><span class="p">())[</span><span class="mi">2</span><span class="p">]</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Storage&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">ecosystem_services</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;The method parallelize the computation of water retention benefits.</span>

<span class="sd">    Args: agent index &quot;i&quot;</span>

<span class="sd">    Returns: water retention benefits for each agent [data frame]</span>

<span class="sd">    Note:</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">df_scenario</span><span class="p">[</span><span class="n">tree_population</span><span class="o">.</span><span class="n">AgentID</span> <span class="o">==</span> <span class="n">AGENTS</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[[</span><span class="s1">&#39;Step&#39;</span><span class="p">,</span> <span class="s1">&#39;AgentID&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">,</span><span class="s1">&#39;BAI&#39;</span><span class="p">,</span> <span class="s1">&#39;LA&#39;</span><span class="p">,</span><span class="s1">&#39;LAI&#39;</span><span class="p">,</span> <span class="s1">&#39;PAI&#39;</span><span class="p">,</span> <span class="s1">&#39;Conifers&#39;</span><span class="p">,</span> <span class="s1">&#39;Under_canopy_area&#39;</span><span class="p">,</span> <span class="s1">&#39;Total_under_canopy_area&#39;</span><span class="p">,</span><span class="s1">&#39;Scenario&#39;</span><span class="p">,</span> <span class="s1">&#39;Precipitation_scale&#39;</span><span class="p">,</span>

    <span class="s1">&#39;SAMPLE_AREA&#39;</span><span class="p">,</span> <span class="s1">&#39;IMPERVIOUS_COVER_SHARE&#39;</span><span class="p">,</span> <span class="s1">&#39;PERVIOUS_COVER_SHARE&#39;</span><span class="p">,</span> <span class="s1">&#39;POPULATION_AREA&#39;</span><span class="p">,</span> <span class="s1">&#39;POPULATION_SAMPLE_TREE_RATIO&#39;</span><span class="p">]]</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">weather_forcast</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Step&#39;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;Step&#39;</span><span class="p">,</span> <span class="s1">&#39;AgentID&#39;</span><span class="p">])</span>

    <span class="c1"># Calculate plant area index (PAI) in leaf-on and leaf-off seasons</span>

    <span class="n">output</span><span class="p">[</span><span class="s1">&#39;PAI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pai_seasons</span><span class="p">(</span><span class="n">output</span><span class="p">[[</span><span class="s1">&#39;Date_time&#39;</span><span class="p">,</span> <span class="s1">&#39;BAI&#39;</span><span class="p">,</span> <span class="s1">&#39;LAI&#39;</span><span class="p">,</span> <span class="s1">&#39;Conifers&#39;</span><span class="p">]],</span>

                                        <span class="n">Leaf_on_transition_day_start</span><span class="p">,</span> <span class="n">Leaf_off_transition_day_start</span><span class="p">,</span>

                                        <span class="n">LEAF_TRANSITION_DAYS</span><span class="p">)</span>

    <span class="c1"># Calculate potential evapotranspiration over the vegetation and ground areas</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">potential_evapotranspiration</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>

        <span class="n">Canopy_cover_fraction</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="kp">exp</span><span class="p">(</span><span class="o">-</span><span class="n">KAPPA</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">PAI</span><span class="p">),</span>

        <span class="n">Maximum_vegetation_storage</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">SL</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">PAI</span><span class="p">,</span>

        <span class="n">Through_canopy_precipitation</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Precipitation</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">Canopy_cover_fraction</span><span class="p">),</span>

        <span class="n">Canopy_interception</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Precipitation</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">Through_canopy_precipitation</span>

    <span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">ped3</span><span class="p">(</span><span class="n">output</span><span class="p">,</span>

        <span class="n">evp_v</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span>

        <span class="n">evp_g</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>

        <span class="n">Canopy_drip</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">x</span><span class="o">.</span><span class="n">Vegetation_storage</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">Maximum_vegetation_storage</span><span class="p">)),</span>

        <span class="n">Evaporation_from_vegetation</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">x</span><span class="o">.</span><span class="n">Canopy_interception</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">Canopy_drip</span><span class="p">)),</span>

        <span class="n">Precipitation_on_the_ground_with_vegetation</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">Canopy_drip</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">Through_canopy_precipitation</span><span class="p">,</span>

        <span class="n">Vegetation_storage</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Vegetation_storage</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">Maximum_vegetation_storage</span><span class="p">),</span>

        <span class="n">Run_off_v</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">x</span><span class="o">.</span><span class="n">Impervious_cover_storage_v</span><span class="o">-</span><span class="n">MAXIMUM_IMPERVIOUS_COVER_STORAGE</span><span class="p">)),</span>

        <span class="n">Evaporation_from_impervious_cover_v</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">x</span><span class="o">.</span><span class="n">Precipitation_on_the_ground_with_vegetation</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">Run_off_v</span><span class="p">)),</span>

        <span class="n">Impervious_cover_storage_v</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Impervious_cover_storage_v</span><span class="p">,</span> <span class="n">MAXIMUM_IMPERVIOUS_COVER_STORAGE</span><span class="p">),</span>

        <span class="n">Infiltration_v</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">x</span><span class="o">.</span><span class="n">Pervious_cover_storage_v</span><span class="o">-</span><span class="n">MAXIMUM_PERVIOUS_COVER_STORAGE</span><span class="p">)),</span>

        <span class="n">Evaporation_from_pervious_cover_v</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">x</span><span class="o">.</span><span class="n">Precipitation_on_the_ground_with_vegetation</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">Infiltration_v</span><span class="p">)),</span>

        <span class="n">Pervious_cover_storage_v</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="kp">minimum</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">Pervious_cover_storage_v</span><span class="p">,</span> <span class="n">MAXIMUM_PERVIOUS_COVER_STORAGE</span><span class="p">)</span>

    <span class="p">)</span>

    <span class="c1"># Annual aggregation</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Scenario&#39;</span><span class="p">,</span><span class="s1">&#39;Precipitation_scale&#39;</span><span class="p">,</span><span class="s1">&#39;AgentID&#39;</span><span class="p">,</span><span class="s1">&#39;Step&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>

        <span class="n">Leaf_area</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;LA&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">mean</span><span class="p">),</span>

        <span class="n">Under_canopy_area</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Under_canopy_area&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">mean</span><span class="p">),</span>

        <span class="n">SAMPLE_AREA</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;SAMPLE_AREA&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">mean</span><span class="p">),</span>

        <span class="n">IMPERVIOUS_COVER_SHARE</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;IMPERVIOUS_COVER_SHARE&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">mean</span><span class="p">),</span>

        <span class="n">PERVIOUS_COVER_SHARE</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;PERVIOUS_COVER_SHARE&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">mean</span><span class="p">),</span>

        <span class="n">POPULATION_AREA</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;POPULATION_AREA&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">mean</span><span class="p">),</span>

        <span class="n">POPULATION_SAMPLE_TREE_RATIO</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;POPULATION_SAMPLE_TREE_RATIO&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">mean</span><span class="p">),</span>

        <span class="n">Annual_precipitation</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Precipitation&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">sum</span><span class="p">),</span>

        <span class="n">Annual_canopy_interception_loss</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Evaporation_from_vegetation&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">sum</span><span class="p">),</span>

        <span class="n">Annual_run_off_v</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Run_off_v&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">sum</span><span class="p">),</span>

        <span class="n">Annual_evaporation_from_impervious_cover_v</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Evaporation_from_impervious_cover_v&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">sum</span><span class="p">),</span>

        <span class="n">Annual_infiltration_v</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;Infiltration_v&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">sum</span><span class="p">),</span>

        <span class="n">Annual_evaporation_from_pervious_cover_v</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;Evaporation_from_pervious_cover_v&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">sum</span><span class="p">),</span>

        <span class="n">Annual_transpiration</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;Transpiration&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">sum</span><span class="p">),</span>

        <span class="n">Total_under_canopy_area</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;Total_under_canopy_area&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="kp">mean</span><span class="p">),</span>

    <span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="n">output</span><span class="p">[</span><span class="s1">&#39;Annual_stormwater_retention&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">Annual_transpiration</span> <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">Annual_canopy_interception_loss</span> <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">Annual_evaporation_from_impervious_cover_v</span><span class="o">*</span><span class="n">output</span><span class="o">.</span><span class="n">IMPERVIOUS_COVER_SHARE</span> <span class="o">+</span> <span class="n">output</span><span class="o">.</span><span class="n">Annual_evaporation_from_pervious_cover_v</span><span class="o">*</span><span class="n">output</span><span class="o">.</span><span class="n">PERVIOUS_COVER_SHARE</span>

    <span class="k">return</span> <span class="n">output</span>
</code></pre></div>

</details>
<h2 id="functions">Functions</h2>
<h3 id="c_air">C_air</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">C_air</span><span class="p">(</span>
    <span class="n">dew_point_temperature</span><span class="p">,</span>
    <span class="n">temperature</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculates water vapor concentration in the air.</p>
<p>Args:
    Temperature [C] 
    Dew point temperature [C]</p>
<p>Returns:
    Water vapor concentration in the air in [g/m^3]</p>
<p>Note:
        Temerature in celsius [C] is converted to kelvins [K] such that T(K) = T(C)+273.15.
        The formula also includes vapor pressure e() in [kPa].  </p>
<div class="codehilite"><pre><span></span><code>    The function is built upon the following book:
    Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.

    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">C_air</span><span class="p">(</span><span class="n">dew_point_temperature</span><span class="p">,</span><span class="w"> </span><span class="n">temperature</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;The method calculates water vapor concentration in the air.</span>

<span class="ss">    Args:</span>

<span class="ss">        Temperature [C]</span>

<span class="ss">        Dew point temperature [C]</span>

<span class="ss">    Returns:</span>

<span class="ss">        Water vapor concentration in the air in [g/m^3]</span>

<span class="ss">    Note:</span>

<span class="ss">            Temerature in celsius [C] is converted to kelvins [K] such that T(K) = T(C)+273.15.</span>

<span class="ss">            The formula also includes vapor pressure e() in [kPa].</span>

<span class="ss">            The function is built upon the following book:</span>

<span class="ss">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="ss">            And a paper:</span>

<span class="ss">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="ss">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="ss">    Todo:</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">2165</span><span class="o">*</span><span class="n">e</span><span class="p">(</span><span class="n">dew_point_temperature</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">temperature</span><span class="o">+</span><span class="mf">273.15</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="c_leaf">C_leaf</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">C_leaf</span><span class="p">(</span>
    <span class="n">temperature</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculates water vapor concentration at the evaporating surfaces within the leaf.</p>
<p>Args:
    Temperature [C] </p>
<p>Returns:
    Water vapor concentration at the evaporating surfaces within the leaf in [g/m^3]</p>
<p>Note:
        Temerature in celsius [C] is converted to kelvins [K] such that T(K) = T(C)+273.15.
        The formula also includes saturated vapor pressure e_s() in [kPa].  </p>
<div class="codehilite"><pre><span></span><code>    The function is built upon the following book:
    Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.

    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">C_leaf</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;The method calculates water vapor concentration at the evaporating surfaces within the leaf.</span>

<span class="ss">    Args:</span>

<span class="ss">        Temperature [C]</span>

<span class="ss">    Returns:</span>

<span class="ss">        Water vapor concentration at the evaporating surfaces within the leaf in [g/m^3]</span>

<span class="ss">    Note:</span>

<span class="ss">            Temerature in celsius [C] is converted to kelvins [K] such that T(K) = T(C)+273.15.</span>

<span class="ss">            The formula also includes saturated vapor pressure e_s() in [kPa].</span>

<span class="ss">            The function is built upon the following book:</span>

<span class="ss">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="ss">            And a paper:</span>

<span class="ss">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="ss">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="ss">    Todo:</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">2165</span><span class="o">*</span><span class="n">e_s</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">temperature</span><span class="o">+</span><span class="mf">273.15</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="d">D</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">D</span><span class="p">(</span>
    <span class="n">temperature</span><span class="p">,</span>
    <span class="n">dew_point_temperature</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculates vapor pressure deficit.</p>
<p>Args:
    Temperature in [C]
    Dew point temperature in [C]  </p>
<p>Returns:
    Vapor pressure deficit in [kPa]</p>
<p>Note:
        It includes in calculation vapor pressure as well as saturated vapor pressure, both in [kPa], which 
        are calculated with functions e() e_s().</p>
<div class="codehilite"><pre><span></span><code>    The function is built upon the following book:
    Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.

    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">D</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="n">dew_point_temperature</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;The method calculates vapor pressure deficit.</span>

<span class="ss">    Args:</span>

<span class="ss">        Temperature in [C]</span>

<span class="ss">        Dew point temperature in [C]</span>

<span class="ss">    Returns:</span>

<span class="ss">        Vapor pressure deficit in [kPa]</span>

<span class="ss">    Note:</span>

<span class="ss">            It includes in calculation vapor pressure as well as saturated vapor pressure, both in [kPa], which</span>

<span class="ss">            are calculated with functions e() e_s().</span>

<span class="ss">            The function is built upon the following book:</span>

<span class="ss">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="ss">            And a paper:</span>

<span class="ss">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="ss">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="ss">    Todo:</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">e_s</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">-</span><span class="n">e</span><span class="p">(</span><span class="n">dew_point_temperature</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="delta">DELTA</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">DELTA</span><span class="p">(</span>
    <span class="n">temperature</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculates the slope of vapor pressure temperature curve.</p>
<p>Args:
    Temperature in [C]   </p>
<p>Returns:
    Slope of vapor pressure temperature curve in [kPa/C]</p>
<p>Note:
    It includes in calculation saturated vapor pressure in [kPa] which is calculated with function e_s()!</p>
<div class="codehilite"><pre><span></span><code>The function is built upon the following book:
    Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.

    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">DELTA</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;The method calculates the slope of vapor pressure temperature curve.</span>

<span class="ss">    Args:</span>

<span class="ss">        Temperature in [C]</span>

<span class="ss">    Returns:</span>

<span class="ss">        Slope of vapor pressure temperature curve in [kPa/C]</span>

<span class="ss">    Note:</span>

<span class="ss">        It includes in calculation saturated vapor pressure in [kPa] which is calculated with function e_s()!</span>

<span class="ss">        The function is built upon the following book:</span>

<span class="ss">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="ss">            And a paper:</span>

<span class="ss">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="ss">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="ss">    Todo:</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">4098</span><span class="o">*</span><span class="n">e_s</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">237.3</span><span class="o">+</span><span class="n">temperature</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="u_t">U_t</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">U_t</span><span class="p">(</span>
    <span class="n">wind_speed</span><span class="p">,</span>
    <span class="n">wind_estimate_height</span>
<span class="p">)</span>
</code></pre></div>

<p>The method estimates wind speed at the tree top.</p>
<p>Args:
    Measured wind speed [m/s] 
    Wind estimate height (tree height) [m]</p>
<p>Returns:
    Wind speed at the tree top in [m/s]</p>
<p>Note:
        The method is using two other parameters:
            Wind measurement height Z_u (usually 10m) and roughness height for water d_w which are set as constants.</p>
<div class="codehilite"><pre><span></span><code>    The function is built upon the following book:
    Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.

    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">U_t</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span><span class="w"> </span><span class="n">wind_estimate_height</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;The method estimates wind speed at the tree top.</span>

<span class="ss">    Args:</span>

<span class="ss">        Measured wind speed [m/s]</span>

<span class="ss">        Wind estimate height (tree height) [m]</span>

<span class="ss">    Returns:</span>

<span class="ss">        Wind speed at the tree top in [m/s]</span>

<span class="ss">    Note:</span>

<span class="ss">            The method is using two other parameters:</span>

<span class="ss">                Wind measurement height Z_u (usually 10m) and roughness height for water d_w which are set as constants.</span>

<span class="ss">            The function is built upon the following book:</span>

<span class="ss">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="ss">            And a paper:</span>

<span class="ss">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="ss">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="ss">    Todo:</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">wind_speed</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">wind_estimate_height</span><span class="o">/</span><span class="n">d_w</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">Z_u</span><span class="o">/</span><span class="n">d_w</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="compute_leaf_area_index">compute_leaf_area_index</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">compute_leaf_area_index</span><span class="p">(</span>
    <span class="n">dbh</span><span class="p">,</span>
    <span class="n">tree_height</span><span class="p">,</span>
    <span class="n">crown_height</span><span class="p">,</span>
    <span class="n">crown_width</span><span class="p">,</span>
    <span class="n">crown_missing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">shade_factor</span><span class="o">=</span><span class="mf">0.85</span>
<span class="p">)</span>
</code></pre></div>

<p>The function given allometrics of a tree computes its leaf, bark and plant area indices. </p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>dbh</td>
<td>None</td>
<td>(:obj:<code>float</code>): the diameter in cm of the trunk usually measured at 1.3m from the ground.</td>
<td>None</td>
</tr>
<tr>
<td>tree_height</td>
<td>None</td>
<td>(:obj:<code>float</code>): The tree height in meters.</td>
<td>None</td>
</tr>
<tr>
<td>crown_height</td>
<td>None</td>
<td>(:obj:<code>float</code>): The vertical length of tree crown in meters.</td>
<td>None</td>
</tr>
<tr>
<td>crown_width</td>
<td>None</td>
<td>(:obj:<code>float</code>): The horizontal length (diameter) of tree crown in meters.</td>
<td>None</td>
</tr>
<tr>
<td>crown_missing</td>
<td>None</td>
<td>(:obj:<code>float</code>): The percentage loss of the crown.</td>
<td>None</td>
</tr>
<tr>
<td>shade_factor</td>
<td>None</td>
<td>(:obj:<code>float</code>): The percentage of sky covered by foliage and branches.</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>(</td>
<td>obj:<code>tuple</code>): the tuple returns the tree indices (LAI,BAI,PAI)</td>
</tr>
<tr>
<td>Note:</td>
<td></td>
</tr>
<tr>
<td>The beta multipliers and the main equation is based on Nowak (1996).</td>
<td></td>
</tr>
</tbody>
</table>
<p>TODO:
    Parametrize beta multipliers. |</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">compute_leaf_area_index</span><span class="p">(</span><span class="w"></span>

<span class="w">    </span><span class="n">dbh</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">tree_height</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">crown_height</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">crown_width</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">crown_missing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="n">shade_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Calibration</span><span class="p">.</span><span class="n">avg_shade_factor</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">The function given allometrics of a tree computes its leaf, bark and plant area indices.</span>

<span class="s2">    Args:</span>

<span class="s2">        dbh: (:obj:`float`): the diameter in cm of the trunk usually measured at 1.3m from the ground.</span>

<span class="s2">        tree_height: (:obj:`float`): The tree height in meters.</span>

<span class="s2">        crown_height: (:obj:`float`): The vertical length of tree crown in meters.</span>

<span class="s2">        crown_width: (:obj:`float`): The horizontal length (diameter) of tree crown in meters.</span>

<span class="s2">        crown_missing: (:obj:`float`): The percentage loss of the crown.</span>

<span class="s2">        shade_factor: (:obj:`float`): The percentage of sky covered by foliage and branches.</span>

<span class="s2">    Returns:</span>

<span class="s2">        (:obj:`tuple`): the tuple returns the tree indices (LAI,BAI,PAI)</span>

<span class="s2">    Note:</span>

<span class="s2">        The beta multipliers and the main equation is based on Nowak (1996).</span>

<span class="s2">    TODO:</span>

<span class="s2">        Parametrize beta multipliers.</span>

<span class="s2">    </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">crown_missing</span><span class="w"></span>

<span class="w">    </span><span class="n">th</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tree_height</span><span class="w"></span>

<span class="w">    </span><span class="n">cw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">crown_width</span><span class="w"></span>

<span class="w">    </span><span class="n">ch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">crown_height</span><span class="w"></span>

<span class="w">    </span><span class="n">sf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shade_factor</span><span class="w"></span>

<span class="w">    </span><span class="n">beta_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">4.3309</span><span class="w"></span>

<span class="w">    </span><span class="n">beta_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2942</span><span class="w"></span>

<span class="w">    </span><span class="n">beta_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.7312</span><span class="w"></span>

<span class="w">    </span><span class="n">beta_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.7217</span><span class="w"></span>

<span class="w">    </span><span class="n">beta_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0148</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">compute_under_canopy_area</span><span class="p">(</span><span class="n">crown_width</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nf">pow</span><span class="p">((</span><span class="n">crown_width</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">compute_bark_area</span><span class="p">(</span><span class="n">dbh</span><span class="p">,</span><span class="w"> </span><span class="n">tree_height</span><span class="p">,</span><span class="w"> </span><span class="n">crown_height</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="c1"># * 0.01 converts DBH(cm) into meter.</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">dbh</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.01</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">tree_height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">crown_height</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="c1"># Outer surface area estimate below is based on Gacka-Grzesikiewicz (1980).</span><span class="w"></span>

<span class="w">    </span><span class="n">under_canopy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_under_canopy_area</span><span class="p">(</span><span class="n">cw</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">crown_surface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="w">  </span><span class="o">*</span><span class="w"> </span><span class="n">crown_width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">crown_height</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">crown_width</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="w"></span>

<span class="w">    </span><span class="n">bark_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_bark_area</span><span class="p">(</span><span class="n">dbh</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">ch</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">leaf_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">loss</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="n">beta_0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">beta_1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">th</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">beta_2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">beta_3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sf</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">beta_4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">crown_surface</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">leaf_area_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leaf_area</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">under_canopy</span><span class="w"></span>

<span class="w">    </span><span class="n">bark_area_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bark_area</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">under_canopy</span><span class="w"></span>

<span class="w">    </span><span class="n">plant_area_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leaf_area_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bark_area_index</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">leaf_area_index</span><span class="p">,</span><span class="w"> </span><span class="n">bark_area_index</span><span class="p">,</span><span class="w"> </span><span class="n">plant_area_index</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="e">e</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">e</span><span class="p">(</span>
    <span class="n">dew_point_temperature</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculates vapor pressure.</p>
<p>Args:
    Dew point temperature in [C]   </p>
<p>Returns:
    Vapor pressure in [kPa]</p>
<p>Note:
        The function is built upon the following book:
        Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</p>
<div class="codehilite"><pre><span></span><code>    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">e</span><span class="p">(</span><span class="n">dew_point_temperature</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;The method calculates vapor pressure.</span>

<span class="ss">    Args:</span>

<span class="ss">        Dew point temperature in [C]</span>

<span class="ss">    Returns:</span>

<span class="ss">        Vapor pressure in [kPa]</span>

<span class="ss">    Note:</span>

<span class="ss">            The function is built upon the following book:</span>

<span class="ss">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="ss">            And a paper:</span>

<span class="ss">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="ss">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="ss">    Todo:</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">0.6108</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="mf">17.27</span><span class="o">*</span><span class="n">dew_point_temperature</span><span class="o">/</span><span class="p">(</span><span class="mf">237.3</span><span class="o">+</span><span class="n">dew_point_temperature</span><span class="p">))</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="e_s">e_s</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">e_s</span><span class="p">(</span>
    <span class="n">temperature</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculates saturated vapor pressure.</p>
<p>Args:
    Temperature in [C]   </p>
<p>Returns:
    Saturated vapor pressure in [kPa]</p>
<p>Note:
        The function is built upon the following book:
        Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</p>
<div class="codehilite"><pre><span></span><code>    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">e_s</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;The method calculates saturated vapor pressure.</span>

<span class="ss">    Args:</span>

<span class="ss">        Temperature in [C]</span>

<span class="ss">    Returns:</span>

<span class="ss">        Saturated vapor pressure in [kPa]</span>

<span class="ss">    Note:</span>

<span class="ss">            The function is built upon the following book:</span>

<span class="ss">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="ss">            And a paper:</span>

<span class="ss">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="ss">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="ss">    Todo:</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">0.6108</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="mf">17.27</span><span class="o">*</span><span class="n">temperature</span><span class="o">/</span><span class="p">(</span><span class="mf">237.3</span><span class="o">+</span><span class="n">temperature</span><span class="p">))</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="ecosystem_services">ecosystem_services</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">ecosystem_services</span><span class="p">(</span>
    <span class="n">i</span>
<span class="p">)</span>
</code></pre></div>

<p>The method parallelize the computation of water retention benefits.</p>
<p>Args: agent index "i"</p>
<p>Returns: water retention benefits for each agent [data frame] </p>
<p>Note:</p>
<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">ecosystem_services</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;The method parallelize the computation of water retention benefits.</span>

<span class="w">    </span><span class="nl">Args</span><span class="p">:</span><span class="w"> </span><span class="n">agent</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="s">&quot;i&quot;</span><span class="w"></span>

<span class="w">    </span><span class="nl">Returns</span><span class="p">:</span><span class="w"> </span><span class="n">water</span><span class="w"> </span><span class="n">retention</span><span class="w"> </span><span class="n">benefits</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">agent</span><span class="w"> </span><span class="p">[</span><span class="n">data</span><span class="w"> </span><span class="n">frame</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="nl">Note</span><span class="p">:</span><span class="w"></span>

<span class="w">    </span><span class="nl">Todo</span><span class="p">:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_scenario</span><span class="p">[</span><span class="n">tree_population</span><span class="p">.</span><span class="n">AgentID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">AGENTS</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="w"></span>

<span class="w">    </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output</span><span class="p">[[</span><span class="err">&#39;</span><span class="n">Step</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">AgentID</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">height</span><span class="sc">&#39;,&#39;</span><span class="n">BAI</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">LA</span><span class="sc">&#39;,&#39;</span><span class="n">LAI</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">PAI</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Conifers</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Under_canopy_area</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Total_under_canopy_area</span><span class="sc">&#39;,&#39;</span><span class="n">Scenario</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Precipitation_scale</span><span class="err">&#39;</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="err">&#39;</span><span class="n">SAMPLE_AREA</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">IMPERVIOUS_COVER_SHARE</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">PERVIOUS_COVER_SHARE</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">POPULATION_AREA</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">POPULATION_SAMPLE_TREE_RATIO</span><span class="err">&#39;</span><span class="p">]]</span><span class="w"></span>

<span class="w">    </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">merge</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">weather_forcast</span><span class="p">,</span><span class="w"> </span><span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="err">&#39;</span><span class="n">Step</span><span class="err">&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">how</span><span class="o">=</span><span class="err">&#39;</span><span class="n">left</span><span class="err">&#39;</span><span class="p">).</span><span class="n">sort_values</span><span class="p">([</span><span class="err">&#39;</span><span class="n">Step</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">AgentID</span><span class="err">&#39;</span><span class="p">])</span><span class="w"></span>

<span class="w">    </span><span class="cp"># Calculate plant area index (PAI) in leaf-on and leaf-off seasons</span>

<span class="w">    </span><span class="n">output</span><span class="p">[</span><span class="err">&#39;</span><span class="n">PAI</span><span class="err">&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pai_seasons</span><span class="p">(</span><span class="n">output</span><span class="p">[[</span><span class="err">&#39;</span><span class="n">Date_time</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">BAI</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">LAI</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Conifers</span><span class="err">&#39;</span><span class="p">]],</span><span class="w"></span>

<span class="w">                                        </span><span class="n">Leaf_on_transition_day_start</span><span class="p">,</span><span class="w"> </span><span class="n">Leaf_off_transition_day_start</span><span class="p">,</span><span class="w"></span>

<span class="w">                                        </span><span class="n">LEAF_TRANSITION_DAYS</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="cp"># Calculate potential evapotranspiration over the vegetation and ground areas</span>

<span class="w">    </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">potential_evapotranspiration</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="k">assign</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">Canopy_cover_fraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">KAPPA</span><span class="o">*</span><span class="n">x</span><span class="p">.</span><span class="n">PAI</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Maximum_vegetation_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">SL</span><span class="o">*</span><span class="n">x</span><span class="p">.</span><span class="n">PAI</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">Through_canopy_precipitation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Precipitation</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="n">Canopy_cover_fraction</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Canopy_interception</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Precipitation</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="n">Through_canopy_precipitation</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ped3</span><span class="p">(</span><span class="n">output</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">evp_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">evp_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="k">assign</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">Canopy_drip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">x</span><span class="p">.</span><span class="n">Vegetation_storage</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="n">Maximum_vegetation_storage</span><span class="p">)),</span><span class="w"></span>

<span class="w">        </span><span class="n">Evaporation_from_vegetation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">x</span><span class="p">.</span><span class="n">Canopy_interception</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="n">Canopy_drip</span><span class="p">)),</span><span class="w"></span>

<span class="w">        </span><span class="n">Precipitation_on_the_ground_with_vegetation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Canopy_drip</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Through_canopy_precipitation</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">Vegetation_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Vegetation_storage</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Maximum_vegetation_storage</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Run_off_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">x</span><span class="p">.</span><span class="n">Impervious_cover_storage_v</span><span class="o">-</span><span class="n">MAXIMUM_IMPERVIOUS_COVER_STORAGE</span><span class="p">)),</span><span class="w"></span>

<span class="w">        </span><span class="n">Evaporation_from_impervious_cover_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">x</span><span class="p">.</span><span class="n">Precipitation_on_the_ground_with_vegetation</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="n">Run_off_v</span><span class="p">)),</span><span class="w"></span>

<span class="w">        </span><span class="n">Impervious_cover_storage_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Impervious_cover_storage_v</span><span class="p">,</span><span class="w"> </span><span class="n">MAXIMUM_IMPERVIOUS_COVER_STORAGE</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Infiltration_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">x</span><span class="p">.</span><span class="n">Pervious_cover_storage_v</span><span class="o">-</span><span class="n">MAXIMUM_PERVIOUS_COVER_STORAGE</span><span class="p">)),</span><span class="w"></span>

<span class="w">        </span><span class="n">Evaporation_from_pervious_cover_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">x</span><span class="p">.</span><span class="n">Precipitation_on_the_ground_with_vegetation</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="n">Infiltration_v</span><span class="p">)),</span><span class="w"></span>

<span class="w">        </span><span class="n">Pervious_cover_storage_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Pervious_cover_storage_v</span><span class="p">,</span><span class="w"> </span><span class="n">MAXIMUM_PERVIOUS_COVER_STORAGE</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="cp"># Annual aggregation</span>

<span class="w">    </span><span class="n">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="err">&#39;</span><span class="n">Scenario</span><span class="sc">&#39;,&#39;</span><span class="n">Precipitation_scale</span><span class="sc">&#39;,&#39;</span><span class="n">AgentID</span><span class="sc">&#39;,&#39;</span><span class="n">Step</span><span class="err">&#39;</span><span class="p">]).</span><span class="n">agg</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">Leaf_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="err">&#39;</span><span class="n">LA</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Under_canopy_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="err">&#39;</span><span class="n">Under_canopy_area</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">SAMPLE_AREA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="err">&#39;</span><span class="n">SAMPLE_AREA</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">IMPERVIOUS_COVER_SHARE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="err">&#39;</span><span class="n">IMPERVIOUS_COVER_SHARE</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">PERVIOUS_COVER_SHARE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="err">&#39;</span><span class="n">PERVIOUS_COVER_SHARE</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">POPULATION_AREA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="err">&#39;</span><span class="n">POPULATION_AREA</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">POPULATION_SAMPLE_TREE_RATIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="err">&#39;</span><span class="n">POPULATION_SAMPLE_TREE_RATIO</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Annual_precipitation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="err">&#39;</span><span class="n">Precipitation</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">sum</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Annual_canopy_interception_loss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="err">&#39;</span><span class="n">Evaporation_from_vegetation</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">sum</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Annual_run_off_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="err">&#39;</span><span class="n">Run_off_v</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">sum</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Annual_evaporation_from_impervious_cover_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="err">&#39;</span><span class="n">Evaporation_from_impervious_cover_v</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">sum</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Annual_infiltration_v</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s">&quot;Infiltration_v&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">sum</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Annual_evaporation_from_pervious_cover_v</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s">&quot;Evaporation_from_pervious_cover_v&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">sum</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Annual_transpiration</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s">&quot;Transpiration&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">sum</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Total_under_canopy_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="p">.</span><span class="n">NamedAgg</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="err">&#39;</span><span class="n">Total_under_canopy_area</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">mean</span><span class="p">),</span><span class="w"></span>

<span class="w">    </span><span class="p">).</span><span class="n">reset_index</span><span class="p">()</span><span class="w"></span>

<span class="w">    </span><span class="n">output</span><span class="p">[</span><span class="err">&#39;</span><span class="n">Annual_stormwater_retention</span><span class="err">&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="n">Annual_transpiration</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="n">Annual_canopy_interception_loss</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="n">Annual_evaporation_from_impervious_cover_v</span><span class="o">*</span><span class="n">output</span><span class="p">.</span><span class="n">IMPERVIOUS_COVER_SHARE</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="n">Annual_evaporation_from_pervious_cover_v</span><span class="o">*</span><span class="n">output</span><span class="p">.</span><span class="n">PERVIOUS_COVER_SHARE</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">output</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="gamma">gamma</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">gamma</span><span class="p">(</span>
    <span class="n">temperature</span><span class="p">,</span>
    <span class="n">surface_pressure</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculates psychrometric constant.</p>
<p>Args:
    Temperature [C] 
    Surface pressure [kPa]</p>
<p>Returns:
    Psychrometric constant in [kPA/C]</p>
<p>Note:
        It includes in calculation latent heat of vaporization lmbd().</p>
<div class="codehilite"><pre><span></span><code>    The function is built upon the following book:
    Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.

    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">gamma</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="n">surface_pressure</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;The method calculates psychrometric constant.</span>

<span class="ss">    Args:</span>

<span class="ss">        Temperature [C]</span>

<span class="ss">        Surface pressure [kPa]</span>

<span class="ss">    Returns:</span>

<span class="ss">        Psychrometric constant in [kPA/C]</span>

<span class="ss">    Note:</span>

<span class="ss">            It includes in calculation latent heat of vaporization lmbd().</span>

<span class="ss">            The function is built upon the following book:</span>

<span class="ss">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="ss">            And a paper:</span>

<span class="ss">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="ss">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="ss">    Todo:</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">#return</span><span class="w"> </span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">c_p</span><span class="o">*</span><span class="n">surface_pressure</span><span class="o">*</span><span class="mi">10</span><span class="o">/</span><span class="p">(</span><span class="n">lmbd</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">*</span><span class="mf">0.622</span><span class="p">)</span><span class="err">#</span><span class="w"> </span><span class="n">pressure</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">mbar</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">c_p</span><span class="o">*</span><span class="n">surface_pressure</span><span class="o">/</span><span class="p">(</span><span class="n">lmbd</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="o">*</span><span class="mf">0.622</span><span class="p">)</span><span class="err">#</span><span class="w"> </span><span class="n">pressure</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">kPa</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="lmbd">lmbd</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">lmbd</span><span class="p">(</span>
    <span class="n">temperature</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculates latent heat of vaporization.</p>
<p>Args:
    Temperature in [C]     </p>
<p>Returns:
    latent heat of vaporization in [MJ/Kg]</p>
<p>Note:
    The function is built upon the following book:
        Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</p>
<div class="codehilite"><pre><span></span><code>    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">lmbd</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;The method calculates latent heat of vaporization.</span>

<span class="ss">    Args:</span>

<span class="ss">        Temperature in [C]</span>

<span class="ss">    Returns:</span>

<span class="ss">        latent heat of vaporization in [MJ/Kg]</span>

<span class="ss">    Note:</span>

<span class="ss">        The function is built upon the following book:</span>

<span class="ss">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="ss">            And a paper:</span>

<span class="ss">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="ss">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="ss">    Todo:</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">2.501</span><span class="o">-</span><span class="mf">0.002361</span><span class="o">*</span><span class="n">temperature</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="pai_seasons">pai_seasons</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">pai_seasons</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">leaf_on_start</span><span class="p">,</span>
    <span class="n">leaf_off_start</span><span class="p">,</span>
    <span class="n">leaf_transition_days</span>
<span class="p">)</span>
</code></pre></div>

<p>The method updates Plant Area Index (PAI) with respect to leaf on-off seasons.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>A data frame "x" with following variables</td>
<td>None</td>
<td></td>
<td>None</td>
</tr>
<tr>
<td>Date_time</td>
<td>None</td>
<td>(:obj:<code>time</code>): date and time</td>
<td>None</td>
</tr>
<tr>
<td>BAI</td>
<td>None</td>
<td>Bark Area Index</td>
<td>None</td>
</tr>
<tr>
<td>LAI</td>
<td>None</td>
<td>Leaf Area Index</td>
<td>None</td>
</tr>
<tr>
<td>conifers</td>
<td>None</td>
<td>it taks value "true" if conifers and "false" otherwise</td>
<td>None</td>
</tr>
<tr>
<td>leaf_on_start</td>
<td>None</td>
<td>a day in the year when the leaf on season starts. In the case of Glasgow it is April 14 (day 105).</td>
<td></td>
</tr>
<tr>
<td>See also other sources: https://weatherspark.com/y/147740/Average-Weather-at-Glasgow-Airport-United-Kingdom-Year-Round</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>leaf_off_start</td>
<td>None</td>
<td>a day in the year when the leaf off season starts. In the case of Glasgow it is November 2 (day 307).</td>
<td>None</td>
</tr>
<tr>
<td>leaf_transition_days</td>
<td>None</td>
<td>the number of days that the leaf on-off transition last.</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>An array of values of Plant Area Indexes (PAI) over time.</td>
</tr>
</tbody>
</table>
<p>Note:
    The function is built upon the following paper:
    Wang, Jun, Theodore A. Endreny, and David J. Nowak. “Mechanistic Simulation of Tree 
    Effects in an Urban Water Balance Model 1.” JAWRA Journal of the American Water Resources 
    Association 44, no. 1 (February 2008): 75–85. https://doi.org/10.1111/j.1752-1688.2007.00139.x   </p>
<p>Todo: |</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">pai_seasons</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">leaf_on_start</span><span class="p">,</span><span class="w"> </span><span class="n">leaf_off_start</span><span class="p">,</span><span class="w"> </span><span class="n">leaf_transition_days</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">The method updates Plant Area Index (PAI) with respect to leaf on-off seasons.</span>

<span class="s2">    Args:</span>

<span class="s2">        A data frame &quot;</span><span class="n">x</span><span class="s2">&quot; with following variables:</span>

<span class="s2">        Date_time: (:obj:`time`): date and time</span>

<span class="s2">        BAI: Bark Area Index</span>

<span class="s2">        LAI: Leaf Area Index</span>

<span class="s2">        conifers: it taks value &quot;</span><span class="no">true</span><span class="s2">&quot; if conifers and &quot;</span><span class="no">false</span><span class="s2">&quot; otherwise</span>

<span class="s2">        leaf_on_start: a day in the year when the leaf on season starts. In the case of Glasgow it is April 14 (day 105).</span>

<span class="s2">                        See also other sources: https://weatherspark.com/y/147740/Average-Weather-at-Glasgow-Airport-United-Kingdom-Year-Round</span>

<span class="s2">        leaf_off_start: a day in the year when the leaf off season starts. In the case of Glasgow it is November 2 (day 307).</span>

<span class="s2">        leaf_transition_days: the number of days that the leaf on-off transition last.</span>

<span class="s2">    Returns:</span>

<span class="s2">        An array of values of Plant Area Indexes (PAI) over time.</span>

<span class="s2">    Note:</span>

<span class="s2">        The function is built upon the following paper:</span>

<span class="s2">        Wang, Jun, Theodore A. Endreny, and David J. Nowak. “Mechanistic Simulation of Tree</span>

<span class="s2">        Effects in an Urban Water Balance Model 1.” JAWRA Journal of the American Water Resources</span>

<span class="s2">        Association 44, no. 1 (February 2008): 75–85. https://doi.org/10.1111/j.1752-1688.2007.00139.x</span>

<span class="s2">    Todo:</span>

<span class="s2">    </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">assign</span><span class="p">(</span><span class="n">PAI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="k">where</span><span class="p">(</span><span class="n">x</span><span class="err">[</span><span class="s1">&#39;Conifers&#39;</span><span class="err">]</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="err">[</span><span class="s1">&#39;BAI&#39;</span><span class="err">]</span><span class="o">+</span><span class="n">x</span><span class="err">[</span><span class="s1">&#39;LAI&#39;</span><span class="err">]</span><span class="p">,</span><span class="w"></span>

<span class="w">                                </span><span class="n">np</span><span class="p">.</span><span class="k">where</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Date_time</span><span class="p">.</span><span class="n">dt</span><span class="p">.</span><span class="n">day_of_year</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">leaf_on_start</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="err">[</span><span class="s1">&#39;BAI&#39;</span><span class="err">]</span><span class="p">,</span><span class="w"></span>

<span class="w">                                    </span><span class="n">np</span><span class="p">.</span><span class="k">where</span><span class="p">(((</span><span class="n">x</span><span class="p">.</span><span class="n">Date_time</span><span class="p">.</span><span class="n">dt</span><span class="p">.</span><span class="n">day_of_year</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">leaf_on_start</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Date_time</span><span class="p">.</span><span class="n">dt</span><span class="p">.</span><span class="n">day_of_year</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">leaf_off_start</span><span class="p">)),</span><span class="w"></span>

<span class="w">                                    </span><span class="n">x</span><span class="err">[</span><span class="s1">&#39;LAI&#39;</span><span class="err">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.37</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Date_time</span><span class="p">.</span><span class="n">dt</span><span class="p">.</span><span class="n">day_of_year</span><span class="o">-</span><span class="p">(</span><span class="n">leaf_on_start</span><span class="o">+</span><span class="n">leaf_transition_days</span><span class="o">/</span><span class="mi">2</span><span class="p">))))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="err">[</span><span class="s1">&#39;BAI&#39;</span><span class="err">]</span><span class="p">,</span><span class="w"></span>

<span class="w">                                    </span><span class="n">x</span><span class="err">[</span><span class="s1">&#39;LAI&#39;</span><span class="err">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.37</span><span class="o">*</span><span class="p">((</span><span class="n">leaf_off_start</span><span class="o">+</span><span class="n">leaf_transition_days</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="n">Date_time</span><span class="p">.</span><span class="n">dt</span><span class="p">.</span><span class="n">day_of_year</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="err">[</span><span class="s1">&#39;BAI&#39;</span><span class="err">]</span><span class="p">)))</span><span class="w"></span>

<span class="w">    </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="err">[</span><span class="s1">&#39;PAI&#39;</span><span class="err">]</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="ped1">ped1</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">ped1</span><span class="p">(</span>
    <span class="n">Date_time</span><span class="p">,</span>
    <span class="n">Precipitation</span><span class="p">,</span>
    <span class="n">Potential_evaporation</span><span class="p">,</span>
    <span class="n">Maximum_storage</span><span class="p">,</span>
    <span class="n">evp</span>
<span class="p">)</span>
</code></pre></div>

<p>The method computes precipitation-evaporation dynamics for one type at a time, which can be trees, pervious cover, impervious cover...</p>
<p>Args:
    Date_time [time identifier]
    Precipitation [amount of water hitting the surface area of the type]
    Potential_evaporation [of the type for the given weather conditions]
    Maximum_storage [parameter: maximum storage of the type]
    evp [evaporation coefficient for the type]</p>
<p>Returns:
    Precipitation storage of the type for each hour.</p>
<p>Note:</p>
<div class="codehilite"><pre><span></span><code>    The function is built upon the following book:
    Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.

    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">ped1</span><span class="p">(</span><span class="n">Date_time</span><span class="p">,</span><span class="w"> </span><span class="n">Precipitation</span><span class="p">,</span><span class="w"> </span><span class="n">Potential_evaporation</span><span class="p">,</span><span class="w"> </span><span class="n">Maximum_storage</span><span class="p">,</span><span class="w"> </span><span class="n">evp</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;The method computes precipitation-evaporation dynamics for one type at a time, which can be trees, pervious cover, impervious cover...</span>

<span class="w">    </span><span class="nl">Args</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="n">Date_time</span><span class="w"> </span><span class="p">[</span><span class="n">time</span><span class="w"> </span><span class="n">identifier</span><span class="p">]</span><span class="w"></span>

<span class="w">        </span><span class="n">Precipitation</span><span class="w"> </span><span class="p">[</span><span class="n">amount</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">water</span><span class="w"> </span><span class="n">hitting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">surface</span><span class="w"> </span><span class="n">area</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">type</span><span class="p">]</span><span class="w"></span>

<span class="w">        </span><span class="n">Potential_evaporation</span><span class="w"> </span><span class="p">[</span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">given</span><span class="w"> </span><span class="n">weather</span><span class="w"> </span><span class="n">conditions</span><span class="p">]</span><span class="w"></span>

<span class="w">        </span><span class="n">Maximum_storage</span><span class="w"> </span><span class="p">[</span><span class="n">parameter</span><span class="o">:</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">type</span><span class="p">]</span><span class="w"></span>

<span class="w">        </span><span class="n">evp</span><span class="w"> </span><span class="p">[</span><span class="n">evaporation</span><span class="w"> </span><span class="n">coefficient</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">type</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="nl">Returns</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="n">Precipitation</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="n">hour</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="nl">Note</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">The</span><span class="w"> </span><span class="n">function</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">built</span><span class="w"> </span><span class="n">upon</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">following</span><span class="w"> </span><span class="n">book</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="n">Maidment</span><span class="p">,</span><span class="w"> </span><span class="n">David</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">others</span><span class="p">.</span><span class="w"> </span><span class="err">“</span><span class="n">Handbook</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Hydrology</span><span class="p">,</span><span class="w"> </span><span class="n">McGraw</span><span class="o">-</span><span class="n">Hil</span><span class="p">.</span><span class="err">”</span><span class="w"> </span><span class="n">Inc</span><span class="p">.,</span><span class="w"> </span><span class="n">New</span><span class="w"> </span><span class="n">York</span><span class="p">,</span><span class="w"> </span><span class="n">NY</span><span class="p">,</span><span class="w"> </span><span class="mf">1992.</span><span class="w"></span>

<span class="w">            </span><span class="n">And</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">paper</span><span class="o">:</span><span class="w"></span>

<span class="w">                </span><span class="n">Hirabayashi</span><span class="p">,</span><span class="w"> </span><span class="n">Satoshi</span><span class="p">.</span><span class="w"> </span><span class="err">“</span><span class="n">I</span><span class="o">-</span><span class="n">Tree</span><span class="w"> </span><span class="n">Eco</span><span class="w"> </span><span class="n">United</span><span class="w"> </span><span class="n">States</span><span class="w"> </span><span class="n">County</span><span class="o">-</span><span class="n">Based</span><span class="w"> </span><span class="n">Hydrologic</span><span class="w"> </span><span class="n">Estimates</span><span class="p">.</span><span class="err">”</span><span class="w"></span>

<span class="w">                </span><span class="n">Washington</span><span class="p">,</span><span class="w"> </span><span class="n">DC</span><span class="o">:</span><span class="w"> </span><span class="n">US</span><span class="w"> </span><span class="n">Department</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Agriculture</span><span class="p">,</span><span class="w"> </span><span class="n">Forest</span><span class="w"> </span><span class="n">Service</span><span class="p">,</span><span class="w"> </span><span class="mf">2015.</span><span class="w"></span>

<span class="w">    </span><span class="nl">Todo</span><span class="p">:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="err">&#39;</span><span class="n">Date_time</span><span class="err">&#39;</span><span class="o">:</span><span class="n">Date_time</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;</span><span class="n">Precipitation</span><span class="err">&#39;</span><span class="o">:</span><span class="n">Precipitation</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="err">&#39;</span><span class="n">Potential_evaporation</span><span class="err">&#39;</span><span class="o">:</span><span class="n">Potential_evaporation</span><span class="p">})</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s">&quot;Storage&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="err">&#39;</span><span class="n">Potential_evaporation_lag1</span><span class="err">&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">Potential_evaporation</span><span class="p">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">interpolate</span><span class="p">(</span><span class="n">limit_direction</span><span class="w"> </span><span class="o">=</span><span class="err">&#39;</span><span class="n">backward</span><span class="err">&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">func2</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="cp"># non local variable ==&gt; will use pre_value from the ped function</span>

<span class="w">        </span><span class="n">nonlocal</span><span class="w"> </span><span class="n">x</span><span class="w"></span>

<span class="w">        </span><span class="n">new_value</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">new_value</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">np</span><span class="p">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">np</span><span class="p">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">Maximum_storage</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">row</span><span class="p">[</span><span class="err">&#39;</span><span class="n">Precipitation</span><span class="err">&#39;</span><span class="p">]</span><span class="o">-</span><span class="w"></span>

<span class="w">        </span><span class="n">np</span><span class="p">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">Maximum_storage</span><span class="p">,</span><span class="n">x</span><span class="p">),((</span><span class="n">np</span><span class="p">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">Maximum_storage</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="w"></span>

<span class="w">        </span><span class="n">Maximum_storage</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">evp</span><span class="p">)</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="err">&#39;</span><span class="n">Potential_evaporation_lag1</span><span class="err">&#39;</span><span class="p">]))))</span><span class="w"></span>

<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_value</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">new_value</span><span class="w"></span>

<span class="w">    </span><span class="cp"># This line might throw a SettingWithCopyWarning warning</span>

<span class="w">    </span><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="o">:</span><span class="p">,</span><span class="err">&#39;</span><span class="n">Storage</span><span class="err">&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="o">:</span><span class="p">,</span><span class="o">:</span><span class="p">].</span><span class="n">apply</span><span class="p">(</span><span class="n">func2</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="s">&quot;Storage&quot;</span><span class="p">]</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="ped3">ped3</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">ped3</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span>
    <span class="n">evp_v</span><span class="p">,</span>
    <span class="n">evp_g</span>
<span class="p">)</span>
</code></pre></div>

<p>The method computes precipitation-evaporation dynamics for each tree as well as the impervious and pervious covers.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>A data frame including the following variables</td>
<td>None</td>
<td></td>
<td>None</td>
</tr>
<tr>
<td>Evaporation coefficient for trees</td>
<td>None</td>
<td>evp_v</td>
<td>None</td>
</tr>
<tr>
<td>Evaporation coefficient for ground</td>
<td>None</td>
<td>evp_g</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>A data frame with new variables: Vegetation_storage, Impervious_cover_storage_v, Pervious_cover_storage_v for each hour.</td>
</tr>
</tbody>
</table>
<p>Note:</p>
<div class="codehilite"><pre><span></span><code>    The function is built upon the following book:
    Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.

    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo: |</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">ped3</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">evp_v</span><span class="p">,</span><span class="w"> </span><span class="n">evp_g</span><span class="p">):</span><span class="w"></span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;The method computes precipitation-evaporation dynamics for each tree as well as the impervious and pervious covers.</span>

<span class="sd">    Args:</span>

<span class="sd">        A data frame including the following variables:</span>

<span class="sd">        Evaporation coefficient for trees: evp_v</span>

<span class="sd">        Evaporation coefficient for ground: evp_g</span>

<span class="sd">    Returns:</span>

<span class="sd">        A data frame with new variables: Vegetation_storage, Impervious_cover_storage_v, Pervious_cover_storage_v for each hour.</span>

<span class="sd">    Note:</span>

<span class="sd">            The function is built upon the following book:</span>

<span class="sd">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="sd">            And a paper:</span>

<span class="sd">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="sd">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="sd">    Todo:</span>

<span class="sd">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Storage&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Potential_evaporation_v_lag1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">.</span><span class="n">Potential_evaporation_v</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">limit_direction</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Potential_evaporation_g_lag1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">.</span><span class="n">Potential_evaporation_g</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">limit_direction</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">    </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">func2</span><span class="p">(</span><span class="n">row</span><span class="p">):</span><span class="w"></span>

<span class="w">        </span><span class="c1"># non local variable ==&gt; will use pre_value from the ped function</span><span class="w"></span>

<span class="w">        </span><span class="n">nonlocal</span><span class="w"> </span><span class="n">x</span><span class="w"></span>

<span class="w">        </span><span class="n">nonlocal</span><span class="w"> </span><span class="n">y</span><span class="w"></span>

<span class="w">        </span><span class="n">nonlocal</span><span class="w"> </span><span class="n">z</span><span class="w"></span>

<span class="w">        </span><span class="n">new_value_x</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Maximum_vegetation_storage&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Canopy_interception&#39;</span><span class="p">]</span><span class="o">-</span><span class="w"></span>

<span class="w">        </span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Maximum_vegetation_storage&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">),((</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Maximum_vegetation_storage&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="w"></span>

<span class="w">        </span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Maximum_vegetation_storage&#39;</span><span class="p">])</span><span class="o">**</span><span class="p">(</span><span class="n">evp_v</span><span class="p">)</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Potential_evaporation_v_lag1&#39;</span><span class="p">]))))</span><span class="w"></span>

<span class="w">        </span><span class="n">Precipitation_on_the_ground_with_vegetation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">new_value_x</span><span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Maximum_vegetation_storage&#39;</span><span class="p">]))</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Through_canopy_precipitation&#39;</span><span class="p">]</span><span class="w"></span>

<span class="w">        </span><span class="n">new_value_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">MAXIMUM_IMPERVIOUS_COVER_STORAGE</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Precipitation_on_the_ground_with_vegetation</span><span class="o">-</span><span class="w"></span>

<span class="w">        </span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">MAXIMUM_IMPERVIOUS_COVER_STORAGE</span><span class="p">,</span><span class="n">y</span><span class="p">),((</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">MAXIMUM_IMPERVIOUS_COVER_STORAGE</span><span class="p">,</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="w"></span>

<span class="w">        </span><span class="n">MAXIMUM_IMPERVIOUS_COVER_STORAGE</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">evp_g</span><span class="p">)</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Potential_evaporation_g_lag1&#39;</span><span class="p">]))))</span><span class="w"></span>

<span class="w">        </span><span class="n">new_value_z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">MAXIMUM_PERVIOUS_COVER_STORAGE</span><span class="p">,</span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Precipitation_on_the_ground_with_vegetation</span><span class="o">-</span><span class="w"></span>

<span class="w">        </span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">MAXIMUM_PERVIOUS_COVER_STORAGE</span><span class="p">,</span><span class="n">z</span><span class="p">),((</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">MAXIMUM_PERVIOUS_COVER_STORAGE</span><span class="p">,</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="w"></span>

<span class="w">        </span><span class="n">MAXIMUM_PERVIOUS_COVER_STORAGE</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">evp_g</span><span class="p">)</span><span class="o">*</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Potential_evaporation_g_lag1&#39;</span><span class="p">]))))</span><span class="w"></span>

<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_value_x</span><span class="w"></span>

<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_value_y</span><span class="w"></span>

<span class="w">        </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_value_z</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="n">new_value_x</span><span class="p">,</span><span class="w"> </span><span class="n">new_value_y</span><span class="p">,</span><span class="w"> </span><span class="n">new_value_z</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="c1"># This line might throw a SettingWithCopyWarning warning</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:,</span><span class="s1">&#39;Storage&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:,:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">func2</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Vegetation_storage&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Storage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Impervious_cover_storage_v&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Storage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())[</span><span class="mi">1</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Pervious_cover_storage_v&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Storage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())[</span><span class="mi">2</span><span class="p">]</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Storage&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="potential_evaporation">potential_evaporation</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">potential_evaporation</span><span class="p">(</span>
    <span class="n">temperature</span><span class="p">,</span>
    <span class="n">dew_point</span><span class="p">,</span>
    <span class="n">solar_radiation</span><span class="p">,</span>
    <span class="n">sea_level_pressure</span><span class="p">,</span>
    <span class="n">pai</span><span class="p">,</span>
    <span class="n">wind_speed</span><span class="p">,</span>
    <span class="n">wind_estimate_height</span><span class="p">,</span>
    <span class="n">roughness_height</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculate potential evaporation.</p>
<p>Args: a data frame</p>
<p>Returns: the updated ata frame </p>
<p>Note:</p>
<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="nv">def</span><span class="w"> </span><span class="nv">potential_evaporation</span><span class="ss">(</span><span class="nv">temperature</span>,<span class="w"> </span><span class="nv">dew_point</span>,<span class="w"> </span><span class="nv">solar_radiation</span>,<span class="w"> </span><span class="nv">sea_level_pressure</span>,<span class="w"> </span><span class="nv">pai</span>,<span class="w"> </span><span class="nv">wind_speed</span>,<span class="w"> </span><span class="nv">wind_estimate_height</span>,<span class="w"> </span><span class="nv">roughness_height</span><span class="ss">)</span>:<span class="w"></span>

<span class="w">    </span><span class="s2">&quot;&quot;</span><span class="err">&quot;The method calculate potential evaporation.</span>

<span class="err">    Args: a data frame</span>

<span class="err">    Returns: the updated ata frame</span>

<span class="err">    Note:</span>

<span class="err">    Todo:</span>

<span class="w">    </span><span class="s2">&quot;&quot;</span><span class="err">&quot;</span>

<span class="err">    potential_evaporation = M_TO_MM*(1/(lmbd(temperature)*rho_w(temperature)))*(DELTA(temperature)*solar_radiation+(rho_a(temperature, sea_level_pressure)*c_p*D(temperature, dew_point))/r_a(wind_speed, wind_estimate_height, roughness_height))/(DELTA(temperature)+gamma(temperature, sea_level_pressure)*(1+(r_s(pai)/r_a(wind_speed, wind_estimate_height, roughness_height))))</span>

<span class="err">    return potential_evaporation</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="potential_evapotranspiration">potential_evapotranspiration</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">potential_evapotranspiration</span><span class="p">(</span>
    <span class="n">df</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculate potential evapotranspiration.</p>
<p>Args: a data frame</p>
<p>Returns: the updated ata frame </p>
<p>Note:</p>
<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">potential_evapotranspiration</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;The method calculate potential evapotranspiration.</span>

<span class="w">    </span><span class="nl">Args:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">frame</span><span class="w"></span>

<span class="w">    </span><span class="nl">Returns:</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">updated</span><span class="w"> </span><span class="n">ata</span><span class="w"> </span><span class="n">frame</span><span class="w"></span>

<span class="w">    </span><span class="nl">Note:</span><span class="w"></span>

<span class="w">    </span><span class="nl">Todo:</span><span class="w"></span>

<span class="w">    </span><span class="s">&quot;&quot;&quot;</span>

<span class="w">    </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="k">assign</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">Potential_evaporation_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="nl">x:</span><span class="w"> </span><span class="n">potential_evaporation</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Temperature</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Dew_Point</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Solar_Radiation</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Sea_Level_Pressure</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">PAI</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Wind_Speed</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">roughness_height_trees</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Potential_evaporation_g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="nl">x:</span><span class="w"> </span><span class="n">potential_evaporation</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Temperature</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Dew_Point</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Solar_Radiation</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Sea_Level_Pressure</span><span class="p">,</span><span class="w"> </span><span class="mh">1</span><span class="w">    </span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Wind_Speed</span><span class="p">,</span><span class="w"> </span><span class="mh">1</span><span class="w">       </span><span class="p">,</span><span class="w"> </span><span class="n">roughness_height_bare_soil</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">PET</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="nl">x:</span><span class="w"> </span><span class="n">potential_evaporation</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Temperature</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Dew_Point</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Solar_Radiation</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Sea_Level_Pressure</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">PAI</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Wind_Speed</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mh">1</span><span class="p">),</span><span class="w"></span>

<span class="w">        </span><span class="n">Transpiration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="nl">x:</span><span class="w"> </span><span class="mh">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mh">6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mh">3600</span><span class="o">/</span><span class="n">x</span><span class="p">.</span><span class="n">PAI</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">maximum</span><span class="p">((</span><span class="n">C_leaf</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Temperature</span><span class="p">)</span><span class="o">-</span><span class="n">C_air</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Dew_Point</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Temperature</span><span class="p">)),</span><span class="mh">0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">r_s</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">PAI</span><span class="p">)</span><span class="o">+</span><span class="n">r_a</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Wind_Speed</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">roughness_height_trees</span><span class="p">))</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="k">assign</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">TF_average_ratio</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="nl">x:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(((</span><span class="n">x</span><span class="p">.</span><span class="n">PET</span><span class="o">&gt;</span><span class="n">x</span><span class="p">.</span><span class="n">Transpiration</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">PET</span><span class="o">&gt;</span><span class="mh">0</span><span class="p">)),</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Transpiration</span><span class="o">/</span><span class="n">x</span><span class="p">.</span><span class="n">PET</span><span class="p">,</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">nan</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="p">[&#39;</span><span class="n">TF_average_ratio</span><span class="p">&#39;]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">groupby</span><span class="p">([&#39;</span><span class="n">AgentID</span><span class="sc">&#39;,&#39;</span><span class="n">Step</span><span class="p">&#39;])[&#39;</span><span class="n">TF_average_ratio</span><span class="p">&#39;].</span><span class="n">transform</span><span class="p">(&#39;</span><span class="n">mean</span><span class="p">&#39;)</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="k">assign</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">Transpiration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="nl">x:</span><span class="w"> </span><span class="n">np</span><span class="p">.</span><span class="n">where</span><span class="p">(((</span><span class="n">x</span><span class="p">.</span><span class="n">PAI</span><span class="o">&lt;</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">LAI</span><span class="o">+</span><span class="n">x</span><span class="p">.</span><span class="n">BAI</span><span class="p">))</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Transpiration</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">PET</span><span class="p">)),</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">TF_average_ratio</span><span class="o">*</span><span class="n">x</span><span class="p">.</span><span class="n">PET</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Transpiration</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="w"></span>

<span class="w">    </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">&#39;</span><span class="n">TF_average_ratio</span><span class="p">&#39;)</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">df</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="r_a">r_a</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">r_a</span><span class="p">(</span>
    <span class="n">wind_speed</span><span class="p">,</span>
    <span class="n">wind_estimate_height</span><span class="p">,</span>
    <span class="n">roughness_height</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculates aerodynamic resistance.</p>
<p>Args:
    Measured wind speed [m/s] 
    Wind estimate height (tree height) [m]
    Roughness_height [m]</p>
<p>Returns:
    Aerodynamic resistance in [m/s]</p>
<p>Note:
        It includes in calculation wind speed at the tree top U_t.
        If roughness height is negative, a new equation is applied to calculate aerodynamic resistance for
        the evapotranspiration from the soil.</p>
<div class="codehilite"><pre><span></span><code>    The function is built upon the following book:
    Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.

    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">r_a</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span><span class="w"> </span><span class="n">wind_estimate_height</span><span class="p">,</span><span class="w"> </span><span class="n">roughness_height</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;The method calculates aerodynamic resistance.</span>

<span class="ss">    Args:</span>

<span class="ss">        Measured wind speed [m/s]</span>

<span class="ss">        Wind estimate height (tree height) [m]</span>

<span class="ss">        Roughness_height [m]</span>

<span class="ss">    Returns:</span>

<span class="ss">        Aerodynamic resistance in [m/s]</span>

<span class="ss">    Note:</span>

<span class="ss">            It includes in calculation wind speed at the tree top U_t.</span>

<span class="ss">            If roughness height is negative, a new equation is applied to calculate aerodynamic resistance for</span>

<span class="ss">            the evapotranspiration from the soil.</span>

<span class="ss">            The function is built upon the following book:</span>

<span class="ss">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="ss">            And a paper:</span>

<span class="ss">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="ss">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="ss">    Todo:</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">roughness_height</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mf">4.72</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">wind_estimate_height</span><span class="o">/</span><span class="p">(</span><span class="n">Z_ov</span><span class="o">*</span><span class="n">roughness_height</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.53</span><span class="o">*</span><span class="n">U_t</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span><span class="w"> </span><span class="n">wind_estimate_height</span><span class="p">))</span><span class="w"></span>

<span class="w">    </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">208</span><span class="o">/</span><span class="n">U_t</span><span class="p">(</span><span class="n">wind_speed</span><span class="p">,</span><span class="w"> </span><span class="n">wind_estimate_height</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="r_s">r_s</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">r_s</span><span class="p">(</span>
    <span class="n">pai</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculates stomatal resistance.</p>
<p>Args:
    Plant area index (PAI) </p>
<p>Returns:
    Stomatal resistance in [s/m]</p>
<p>Note:
        The function is built upon the following book:
        Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</p>
<div class="codehilite"><pre><span></span><code>    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="nv">def</span><span class="w"> </span><span class="nv">r_s</span><span class="ss">(</span><span class="nv">pai</span><span class="ss">)</span>:<span class="w"></span>

<span class="w">    </span><span class="s2">&quot;&quot;</span><span class="err">&quot;The method calculates stomatal resistance.</span>

<span class="err">    Args:</span>

<span class="err">        Plant area index (PAI)</span>

<span class="err">    Returns:</span>

<span class="err">        Stomatal resistance in [s/m]</span>

<span class="err">    Note:</span>

<span class="err">            The function is built upon the following book:</span>

<span class="err">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="err">            And a paper:</span>

<span class="err">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="err">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="err">    Todo:</span>

<span class="w">    </span><span class="s2">&quot;&quot;</span><span class="err">&quot;</span>

<span class="err">    return 200/pai</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="rho_a">rho_a</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">rho_a</span><span class="p">(</span>
    <span class="n">temperature</span><span class="p">,</span>
    <span class="n">surface_pressure</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculates the density of air.</p>
<p>Args:
    Temperature in [C]
    Surface preasure in [kPa]  </p>
<p>Returns:
    The density of air in [kg/m^3]</p>
<p>Note:
        The function is built upon the following book:
        Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</p>
<div class="codehilite"><pre><span></span><code>    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">rho_a</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span><span class="w"> </span><span class="n">surface_pressure</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;The method calculates the density of air.</span>

<span class="ss">    Args:</span>

<span class="ss">        Temperature in [C]</span>

<span class="ss">        Surface preasure in [kPa]</span>

<span class="ss">    Returns:</span>

<span class="ss">        The density of air in [kg/m^3]</span>

<span class="ss">    Note:</span>

<span class="ss">            The function is built upon the following book:</span>

<span class="ss">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="ss">            And a paper:</span>

<span class="ss">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="ss">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="ss">    Todo:</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">3.486</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">surface_pressure</span><span class="o">/</span><span class="p">(</span><span class="mi">275</span><span class="o">+</span><span class="n">temperature</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
<h3 id="rho_w">rho_w</h3>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">rho_w</span><span class="p">(</span>
    <span class="n">temperature</span>
<span class="p">)</span>
</code></pre></div>

<p>The method calculates the density of water.</p>
<p>Args:
    Temperature in [C]</p>
<p>Returns:
    The density of water in [kg/m^3]</p>
<p>Note:
        The function is built upon the following book:
        Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</p>
<div class="codehilite"><pre><span></span><code>    And a paper:
        Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.” 
        Washington, DC: US Department of Agriculture, Forest Service, 2015.
</code></pre></div>

<p>Todo:</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">def</span><span class="w"> </span><span class="n">rho_w</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">    </span><span class="ss">&quot;&quot;&quot;The method calculates the density of water.</span>

<span class="ss">    Args:</span>

<span class="ss">        Temperature in [C]</span>

<span class="ss">    Returns:</span>

<span class="ss">        The density of water in [kg/m^3]</span>

<span class="ss">    Note:</span>

<span class="ss">            The function is built upon the following book:</span>

<span class="ss">            Maidment, David R and others. “Handbook of Hydrology, McGraw-Hil.” Inc., New York, NY, 1992.</span>

<span class="ss">            And a paper:</span>

<span class="ss">                Hirabayashi, Satoshi. “I-Tree Eco United States County-Based Hydrologic Estimates.”</span>

<span class="ss">                Washington, DC: US Department of Agriculture, Forest Service, 2015.</span>

<span class="ss">    Todo:</span>

<span class="ss">    &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mf">999.88</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.018</span><span class="o">*</span><span class="n">temperature</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.0051</span><span class="o">*</span><span class="n">temperature</span><span class="o">**</span><span class="mi">2</span><span class="w"></span>
</code></pre></div>

</details>
<h2 id="classes">Classes</h2>
<h3 id="calibration">Calibration</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Calibration</span><span class="p">(</span>
    <span class="n">leaf_transition_days</span><span class="o">=</span><span class="mi">28</span><span class="p">,</span>
    <span class="n">leaf_storage</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">,</span>
    <span class="n">pervios_storage_max</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
    <span class="n">impervios_storage_max</span><span class="o">=</span><span class="mf">0.0015</span>
<span class="p">)</span>
</code></pre></div>

<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="n">class</span><span class="w"> </span><span class="n">Calibration</span><span class="p">()</span><span class="o">:</span><span class="w"></span>

<span class="w">    </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">Water retention and impact estimate related parameters setting.</span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span><span class="w"></span>

<span class="w">    </span><span class="c1"># Conversion coefficient meter to millimeter</span><span class="w"></span>

<span class="w">    </span><span class="n">m_to_mm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">    </span><span class="c1"># Extinction coefficient =0.7 for trees and 0.3 for shrubs (Wang et al. 2008)</span><span class="w"></span>

<span class="w">    </span><span class="n">kappa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.7</span><span class="w"></span>

<span class="w">    </span><span class="c1"># Shade factor, is the percentage of sky covered by foliage and branches within</span><span class="w"></span>

<span class="w">    </span><span class="c1"># the perimeter of individual tree crowns, can vary by species from about</span><span class="w"></span>

<span class="w">    </span><span class="c1"># 60% to 95% when trees are in-leaf (McPherson, 1984).</span><span class="w"></span>

<span class="w">    </span><span class="c1"># The value below is set according to Glasgow mean</span><span class="w"></span>

<span class="w">    </span><span class="n">avg_shade_factor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.85</span><span class="w"></span>

<span class="w">    </span><span class="c1"># Specific leaf storage of water (sl =0.0002 m).</span><span class="w"></span>

<span class="w">    </span><span class="n">leaf_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0002</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_to_mm</span><span class="w"></span>

<span class="w">    </span><span class="c1"># Leaf-on leaf_off transition days (Wang_et_al_2008).</span><span class="w"></span>

<span class="w">    </span><span class="n">leaf_transition_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">28</span><span class="w"></span>

<span class="w">    </span><span class="c1"># Specific impervious cover storage of water (=0.0015 m).</span><span class="w"></span>

<span class="w">    </span><span class="n">maximum_impervious_cover_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0015</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_to_mm</span><span class="w"></span>

<span class="w">    </span><span class="c1"># Specific pervious cover storage of water (=0.001 m).</span><span class="w"></span>

<span class="w">    </span><span class="n">maximum_pervious_cover_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.001</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_to_mm</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">__init__</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">leaf_transition_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">leaf_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0002</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">pervios_storage_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0010</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">impervios_storage_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0015</span><span class="w"></span>

<span class="w">        </span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">The constructor method.</span>

<span class="s2">        Args:</span>

<span class="s2">            leaf_transition_days: (:obj:`int`): Leaf-on leaf_off transition days</span>

<span class="s2">            leaf_storage: (:obj:`float`): Specific leaf storage of water.</span>

<span class="s2">            pervios_storage_max: (:obj:`float`): Specific pervious cover storage of water</span>

<span class="s2">            impervios_storage_max: (:obj:`float`): Specific impervious cover storage of water</span>

<span class="s2">        Returns:</span>

<span class="s2">            None</span>

<span class="s2">        Note:</span>

<span class="s2">        TODO:</span>

<span class="s2">            * pass optional settings as key word parameters.</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">leaf_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leaf_storage</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Calibration</span><span class="p">.</span><span class="n">m_to_mm</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">leaf_transition_days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leaf_transition_days</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">maximum_impervious_cover_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">impervios_storage_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Calibration</span><span class="p">.</span><span class="n">m_to_mm</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">maximum_pervious_cover_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pervios_storage_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Calibration</span><span class="p">.</span><span class="n">m_to_mm</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">set</span><span class="n">_surface_storage_rates</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">leaf_storage</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">pervios_storage_max</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">impervios_storage_max</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">Setting specific water storage rates.</span>

<span class="s2">        Args:</span>

<span class="s2">            leaf_storage: (:obj:`float`): Specific leaf storage of water.</span>

<span class="s2">            pervios_storage_max: (:obj:`float`): Specific pervious cover storage of water</span>

<span class="s2">            impervios_storage_max: (:obj:`float`): Specific impervious cover storage of water</span>

<span class="s2">        Returns:</span>

<span class="s2">            None</span>

<span class="s2">        Note:</span>

<span class="s2">        Todo:</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">leaf_storage</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">leaf_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leaf_storage</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Calibration</span><span class="p">.</span><span class="n">m_to_mm</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">impervios_storage_max</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">maximum_impervious_cover_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">impervios_storage_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Calibration</span><span class="p">.</span><span class="n">m_to_mm</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">pervios_storage_max</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">maximum_pervious_cover_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pervios_storage_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Calibration</span><span class="p">.</span><span class="n">m_to_mm</span><span class="w"></span>
</code></pre></div>

</details>
<hr />
<h4 id="class-variables">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">avg_shade_factor</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">kappa</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">leaf_storage</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">leaf_transition_days</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">m_to_mm</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">maximum_impervious_cover_storage</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">maximum_pervious_cover_storage</span>
</code></pre></div>

<h4 id="methods">Methods</h4>
<h4 id="set_surface_storage_rates">set_surface_storage_rates</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">set_surface_storage_rates</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">leaf_storage</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pervios_storage_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">impervios_storage_max</span><span class="o">=</span><span class="kc">None</span>
<span class="p">)</span>
</code></pre></div>

<p>Setting specific water storage rates. </p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>leaf_storage</td>
<td>None</td>
<td>(:obj:<code>float</code>): Specific leaf storage of water.</td>
<td>None</td>
</tr>
<tr>
<td>pervios_storage_max</td>
<td>None</td>
<td>(:obj:<code>float</code>): Specific pervious cover storage of water</td>
<td>None</td>
</tr>
<tr>
<td>impervios_storage_max</td>
<td>None</td>
<td>(:obj:<code>float</code>): Specific impervious cover storage of water</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>None</td>
</tr>
<tr>
<td>Note:</td>
<td></td>
</tr>
</tbody>
</table>
<p>Todo: |</p>
<details class="example">
<summary>View Source</summary>
<div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">set</span><span class="n">_surface_storage_rates</span><span class="p">(</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">leaf_storage</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">pervios_storage_max</span><span class="o">=</span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">        </span><span class="n">impervios_storage_max</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="s2">&quot;</span><span class="se">&quot;&quot;</span><span class="s2">Setting specific water storage rates.</span>

<span class="s2">        Args:</span>

<span class="s2">            leaf_storage: (:obj:`float`): Specific leaf storage of water.</span>

<span class="s2">            pervios_storage_max: (:obj:`float`): Specific pervious cover storage of water</span>

<span class="s2">            impervios_storage_max: (:obj:`float`): Specific impervious cover storage of water</span>

<span class="s2">        Returns:</span>

<span class="s2">            None</span>

<span class="s2">        Note:</span>

<span class="s2">        Todo:</span>

<span class="s2">        </span><span class="se">&quot;&quot;</span><span class="s2">&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">leaf_storage</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">leaf_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">leaf_storage</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Calibration</span><span class="p">.</span><span class="n">m_to_mm</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">impervios_storage_max</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">maximum_impervious_cover_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">impervios_storage_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Calibration</span><span class="p">.</span><span class="n">m_to_mm</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">pervios_storage_max</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">maximum_pervious_cover_storage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pervios_storage_max</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Calibration</span><span class="p">.</span><span class="n">m_to_mm</span><span class="w"></span>
</code></pre></div>

</details>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../" class="btn btn-neutral" title="Index"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script>var base_url = '../../../..';</script>
    <script src="../../../../js/theme_extra.js" defer></script>
    <script src="../../../../js/theme.js" defer></script>
      <script src="../../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
